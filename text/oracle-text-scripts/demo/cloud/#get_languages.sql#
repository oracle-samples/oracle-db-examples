alter table shoe_reviews add (language varchar2(20));
exec ctx_ddl.create_policy('shoe_policy', lexer => 'shoe_lex')

set serveroutput on
declare 
  outtab ctx_doc.language_tab;
  myclob clob;
begin
  for c in (select rowid, review_text from shoe_reviews) loop
     ctx_doc.policy_languages(
       policy_name => 'SHOE_POLICY', 
       document    => c.review_text,
       restab      => outtab );
     for x in (select language, score 
                from table(outtab)
                order by score desc
                fetch next 1 rows only ) loop
        update shoe_reviews set language = x.language where rowid = c.rowid;
     end loop;
   end loop;
end;
/
