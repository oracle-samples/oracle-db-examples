[{"layout":null,"template":null,"templateConfig":null,"name":"OML4R Feature Extraction ESA","description":null,"readOnly":false,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":["%md"," "],"enabled":true,"result":null,"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","# Explicit Semantic Analysis (ESA) for Text Analytics","","Explicit Semantic Analysis (ESA) is an unsupervised algorithm for feature extraction of explicit features based on an existing knowledge base. ESA assists in understanding the meaning of a section of text as a combination of concepts found in the text. Compared to other techniques such as Latent Dirichlet Association (LDA) or Term Frequency-Inverse Document Frequency (TF-IDF), ESA improves text document categorization by calculating `semantic relatedness` (how similar in meaning two words or pieces of text are to each other) between the documents and a set of topics that are explicitly defined and described by humans.","","The Oracle Machine Learning for R function *ore.odmESA* extracts text-based features from a corpus of documents and performs document similarity comparisons. All processing occurs inside Oracle Autonomous Database.","","In this notebook, we cover the basic usage of ESA, where we extract topics from the comments provided. ",""," - Create a small sample dataset"," - Use the ESA Model to predict a feature vector on test data"," - Identify top features"," - Document similarity"," - Change model settings","","Copyright (c) 2024 Oracle Corporation ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" onclick=\"return ! window.open('https://oss.oracle.com/licenses/upl/');\">The Universal Permissive License (UPL), Version 1.0<\/a>","---"],"enabled":true,"result":null,"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information...","message":["%md","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB Documentation<\/a>","* <a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a>","* <a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a>","* <a href=\"https://www.oracle.com/goto/ml-explicit-semantic-analysis\" target=\"_blank\">OML Explicit Semantic Analysis"],"enabled":true,"result":null,"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Import libraries and set display options","message":["%r","","library(ORE)","options(ore.warn.order=FALSE)"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Create and view data","message":["%r","","TITLE <- c('Aids in Africa: Planning for a long war',","                'Mars rover maneuvers for rim shot',","                'Mars express confirms presence of water at Mars south pole',","                'NASA announces major Mars rover finding',","                'Drug access, Asia threat in focus at AIDS summit',","                'NASA Mars Odyssey THEMIS image: typical crater',","                'Road blocks for Aids')","","ID <- 1:length(TITLE)","","df <- data.frame(ID, TITLE)","ESA_TXT <- ore.push(df)","","z.show(ESA_TXT)"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Create a policy for text indexing","message":["%r","","# Drop the text policy if it exists","ore.exec(paste(\"Begin ctx_ddl.drop_policy('ESA_TXT_POLICY'); ","                EXCEPTION WHEN others THEN null; END;\",sep=\"\"))","","# Create text policy","ore.exec(\"Begin ctx_ddl.create_policy('ESA_TXT_POLICY'); End;\")"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Specify model settings","message":["%r","","odm <- list(case_id_column_name     = \"ID\", ","            ODMS_TEXT_POLICY_NAME   = \"ESA_TXT_POLICY\", ","            ODMS_TEXT_MIN_DOCUMENTS = 1, ","            ESAS_MIN_ITEMS          = 1, ","            model_name              = 'ESA_MOD')","","ctx <- list(TITLE = \"TEXT(POLICY_NAME:ESA_TXT_POLICY)(TOKEN_TYPE:STEM)\")"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create an ESA model object ","message":["%r","","# Delete model if it exists","ore.exec(paste(\"BEGIN DBMS_DATA_MINING.DROP_MODEL(model_name=> '\", 'ESA_MOD', \"'); ","EXCEPTION WHEN others THEN null; END;\",sep=\"\"))","","# Create model","esa_mod <- ore.odmESA(~TITLE, ESA_TXT, odm.settings = odm, ctx.settings = ctx)"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View the model settings","message":["%r","","z.show(settings(esa_mod))"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"Show the model details","message":["%r","","summary(esa_mod)"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Show the model details for each feature","message":["%r","","esa_mod$features$COEFFICIENT <- round(esa_mod$features$COEFFICIENT, digits=4)","z.show(head(esa_mod$features, 10))"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View the model name using ALL_MINING_MODELS view","message":["%sql","","SELECT * from all_mining_models WHERE ALGORITHM = 'EXPLICIT_SEMANTIC_ANALYS'"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View model name using USER_MINING_MODELS view","message":["%sql","","SELECT * from user_mining_models where model_name = 'ESA_MOD'"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Make predictions on data","message":["%r","","esa_pred <- predict(esa_mod, ESA_TXT, type = \"class\", supplemental.cols = c(\"ID\", \"TITLE\"))","z.show(esa_pred)"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Feature compare titles","message":["%r","","z.show(feature_compare(esa_mod, ESA_TXT, compare.cols = c('TITLE'), supplemental.cols = c('TITLE')))"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Change the settings and create new model","message":["%r","","new_setting <- list(case_id_column_name = \"ID\", ","                    ODMS_TEXT_POLICY_NAME = \"ESA_TXT_POLICY\",","                    ESAS_VALUE_THRESHOLD = 0.0001, ","                    ODMS_TEXT_MAX_FEATURES = 3, ","                    ESAS_MIN_ITEMS = 1,","                    ESAS_TOPN_FEATURES = 3,","                    model_name = 'ESA_MOD_2')","                    "],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create the model with new settings - 2 features maximum ","message":["%r","","# Delete if ESA model exists, then create it","","ore.exec(paste(\"BEGIN DBMS_DATA_MINING.DROP_MODEL(model_name=> '\", 'ESA_MOD_2', \"'); ","  EXCEPTION WHEN others THEN null; END;\",sep=\"\"))","","esa_mod2 <- ore.odmESA(~TITLE, ESA_TXT, odm.settings = new_setting, ctx.settings = ctx)"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"List ESA model views","message":["%sql","","SELECT view_name, view_type FROM user_mining_model_views","WHERE model_name='ESA_MOD_2'","ORDER BY view_name;"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"The VA view shows associations among features (topics) and words","message":["%md","","*ATTRIBUTE_SUBNAME* refers to words, or tokens. The strength of the associations is measured by *COEFFICIENT*. Higher coefficient values indicate a stronger association."],"enabled":true,"result":null,"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":null,"message":["%sql","","SELECT * from DM$VAESA_MOD_2;"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Show the associations for selected words","message":["%sql","","SELECT ATTRIBUTE_SUBNAME, count(ATTRIBUTE_SUBNAME) FROM DM$VAESA_MOD_2","WHERE ATTRIBUTE_SUBNAME='MARS'","GROUP BY ATTRIBUTE_SUBNAME"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"View the help file for ESA","message":["%r","","help(\"ore.odmESA\")"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Clean-up","message":["%script","","BEGIN","  DBMS_DATA_MINING.DROP_MODEL(model_name => 'ESA_MOD');","  EXCEPTION WHEN others THEN null;","END;","/","BEGIN","  DBMS_DATA_MINING.DROP_MODEL(model_name => 'ESA_MOD_2');","  EXCEPTION WHEN others THEN null;","END;","/"],"enabled":true,"result":null,"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## End of Script"],"enabled":true,"result":null,"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":["%md"," "],"enabled":true,"result":null,"sizeX":0,"hideCode":true,"width":0,"hideResult":true,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]