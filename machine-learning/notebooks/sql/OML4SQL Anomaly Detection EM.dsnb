[{"layout":"zeppelin","template":"dsrgmn3y","templateConfig":"{\"visualization\":{\"filters\":[{\"_id\":1583324064459,\"type\":\"styling\",\"enabled\":true,\"conditions\":{\"operator\":\"and\",\"conditions\":[{\"property\":\"hiddenConnection\",\"operator\":\"*\",\"value\":\"\"}]},\"component\":\"edge\",\"target\":\"edge\",\"properties\":{\"colors\":[\"rgba(0, 0, 0, 0.1)\"],\"style\":[\"dashed\"],\"legendTitle\":[\"Hidden Connection\"]}},{\"_id\":1590499315755,\"type\":\"aggregation\",\"enabled\":true,\"conditions\":{\"operator\":\"and\",\"conditions\":[]},\"component\":\"vertex\",\"target\":\"vertex\",\"properties\":{},\"aggregation\":[{\"source\":\"\",\"type\":\"average\"}]}],\"version\":4}}","name":"OML4SQL Anomaly Detection EM","description":null,"readOnly":false,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":[],"enabled":true,"result":{"startTime":1714398009784,"interpreter":"md.low","endTime":1714398009868,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","# Anomaly Detection to Detect Unusual or Rare Occurrences","","Oracle Machine Learning supports anomaly detection to identify rare or unusual records (customers, transactions, etc.). ","In this notebook, we highlight the use of the Expectation Maximization algorithm, which is already supported for clustering. ","The use of EM expands on the One-Class SVM model approach for anomaly detection. EM can capture the underlying data distribution and flag records ","that do not fit the learned data distribution well. An object is identified as an outlier in an EM Anomaly Detection model if its anomaly ","probability is greater than the specified limit, with a default of 0.05. A label of 1 denotes normal, while a label of 0 denotes anomaly. ","We use the customer and demographics data to predict anomalous customers using prob_anomalous.","The entire machine learning methodology runs inside Oracle Autonomous Database (ADB).","","Copyright (c) 2024 Oracle Corporation ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" onclick=\"return ! window.open('https://oss.oracle.com/licenses/upl/');\">The Universal Permissive License (UPL), Version 1.0<\/a>","---"],"enabled":true,"result":{"startTime":1715729469671,"interpreter":"md.low","endTime":1715729469827,"results":[{"message":"<h1 id=\"anomaly-detection-to-detect-unusual-or-rare-occurrences\">Anomaly Detection to Detect Unusual or Rare Occurrences<\/h1>\n<p>Oracle Machine Learning supports anomaly detection to identify rare or unusual records (customers, transactions, etc.).\nIn this notebook, we highlight the use of the Expectation Maximization algorithm, which is already supported for clustering.\nThe use of EM expands on the One-Class SVM model approach for anomaly detection. EM can capture the underlying data distribution and flag records\nthat do not fit the learned data distribution well. An object is identified as an outlier in an EM Anomaly Detection model if its anomaly\nprobability is greater than the specified limit, with a default of 0.05. A label of 1 denotes normal, while a label of 0 denotes anomaly.\nWe use the customer and demographics data to predict anomalous customers using prob_anomalous.\nThe entire machine learning methodology runs inside Oracle Autonomous Database (ADB).<\/p>\n<p>Copyright (c) 2024 Oracle Corporation<\/p>\n<h6 id=\"the-universal-permissive-license-upl-version-10\"><a href=\"https://oss.oracle.com/licenses/upl/\" onclick=\"return ! window.open('https://oss.oracle.com/licenses/upl/');\">The Universal Permissive License (UPL), Version 1.0<\/a><\/h6>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":10,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md ","","<dl>","<img src=\"http://www.oracle.com/technetwork/database/options/advanced-analytics/anomalydetection-5663169.jpg\" alt=\"OML Notebooks\" width=\"250\"/>","<\/dl> "],"enabled":true,"result":{"startTime":1714398010697,"interpreter":"md.low","endTime":1714398011298,"results":[{"message":"<dl>\n<img src=\"http://www.oracle.com/technetwork/database/options/advanced-analytics/anomalydetection-5663169.jpg\" alt=\"OML Notebooks\" width=\"250\"/>\n<\/dl>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":2,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information ...","message":["%md ","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB Documentation<\/a>","* <a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a>","* <a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a>","* <a href=\"https://www.oracle.com/goto/ml-anomaly-detection\" target=\"_blank\">OML Anomaly Detection<\/a>","* <a href=\"https://oracle.com/goto/ml-expectation-maximization\" target=\"_blank\">OML Expectation Maximization<\/a>"],"enabled":true,"result":{"startTime":1714398011443,"interpreter":"md.low","endTime":1714398011513,"results":[{"message":"<ul>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB Documentation<\/a><\/li>\n<li><a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a><\/li>\n<li><a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a><\/li>\n<li><a href=\"https://www.oracle.com/goto/ml-anomaly-detection\" target=\"_blank\">OML Anomaly Detection<\/a><\/li>\n<li><a href=\"https://oracle.com/goto/ml-expectation-maximization\" target=\"_blank\">OML Expectation Maximization<\/a><\/li>\n<\/ul>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Prepare the datasets for modeling","message":["%script","","CREATE OR REPLACE VIEW DEMOGRAPHICS_V AS","  SELECT CUST_ID, YRS_RESIDENCE, EDUCATION, AFFINITY_CARD, ","         HOUSEHOLD_SIZE, OCCUPATION, BOOKKEEPING_APPLICATION, ","         BULK_PACK_DISKETTES, FLAT_PANEL_MONITOR, HOME_THEATER_PACKAGE,","         OS_DOC_SET_KANJI, PRINTER_SUPPLIES, Y_BOX_GAMES","  FROM   SH.SUPPLEMENTARY_DEMOGRAPHICS;","","CREATE OR REPLACE VIEW CUSTOMERS360_V AS","  SELECT a.CUST_ID, a.CUST_GENDER, a.CUST_MARITAL_STATUS, a.CUST_YEAR_OF_BIRTH, ","         a.CUST_INCOME_LEVEL, a.CUST_CREDIT_LIMIT, b.EDUCATION, b.AFFINITY_CARD, ","         b.HOUSEHOLD_SIZE, b.OCCUPATION, b.YRS_RESIDENCE, b.Y_BOX_GAMES","  FROM   SH.CUSTOMERS a, DEMOGRAPHICS_V b","  WHERE  a.CUST_ID = b.CUST_ID;"],"enabled":true,"result":{"startTime":1714398012144,"interpreter":"script.low","endTime":1714398012249,"results":[{"message":"\nView DEMOGRAPHICS_V created.\n\n\n---------------------------\n\nView CUSTOMERS360_V created.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Build the EM anomaly detection model","message":["%script","","BEGIN DBMS_DATA_MINING.DROP_MODEL('CUSTOMERS360MODEL_AD');","EXCEPTION WHEN OTHERS THEN NULL; END;","/","DECLARE","  v_setlst DBMS_DATA_MINING.SETTING_LIST;","BEGIN","  v_setlst('ALGO_NAME')         := 'ALGO_EXPECTATION_MAXIMIZATION';","  v_setlst('PREP_AUTO')         := 'ON';","  v_setlst('EMCS_OUTLIER_RATE') := '0.1';","        ","  DBMS_DATA_MINING.CREATE_MODEL2(","        MODEL_NAME          => 'CUSTOMERS360MODEL_AD',","        MINING_FUNCTION     => 'CLASSIFICATION',","        DATA_QUERY          => 'SELECT * FROM CUSTOMERS360_V',","        CASE_ID_COLUMN_NAME => 'CUST_ID',","        SET_LIST            => v_setlst,","        TARGET_COLUMN_NAME  => NULL); -- NULL target indicates anomaly detection      ","END;"],"enabled":true,"result":{"startTime":1714398012355,"interpreter":"script.low","endTime":1714398013789,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Evaluate the model"],"enabled":true,"result":{"startTime":1714398013902,"interpreter":"md.low","endTime":1714398013973,"results":[{"message":"<h2 id=\"evaluate-the-model\">Evaluate the model<\/h2>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Display model details","message":["%sql","","SELECT * ","FROM  TABLE(dbms_data_mining.get_model_details_global('CUSTOMERS360MODEL_AD'))","ORDER BY global_detail_name;"],"enabled":true,"result":{"startTime":1714398014084,"interpreter":"sql.low","endTime":1714398014190,"results":[{"message":"GLOBAL_DETAIL_NAME\tGLOBAL_DETAIL_VALUE\nLOGLIKELIHOOD\t-3.4040876550830736\nNUM_COMPONENTS\t20\nRANDOM_SEED\t0\nREMOVED_COMPONENTS\t0\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Display the top 5 most anomalous customers","message":["%sql","","SELECT * ","FROM (SELECT CUST_ID, round(prob_anomalous,2) prob_anomalous,  ","             YRS_RESIDENCE, CUST_MARITAL_STATUS, ","             rank() OVER (ORDER BY prob_anomalous DESC) rnk ","      FROM (SELECT CUST_ID, HOUSEHOLD_SIZE, YRS_RESIDENCE, CUST_GENDER, CUST_MARITAL_STATUS, ","                   prediction_probability(CUSTOMERS360MODEL_AD, '0' USING *) prob_anomalous","            FROM CUSTOMERS360_V))","WHERE rnk <= 5","ORDER BY prob_anomalous DESC;"],"enabled":true,"result":{"startTime":1714398014297,"interpreter":"sql.low","endTime":1714398014432,"results":[{"message":"CUST_ID\tPROB_ANOMALOUS\tYRS_RESIDENCE\tCUST_MARITAL_STATUS\tRNK\n102926\t1\t2\tMarried\t1\n102555\t1\t14\tNeverM\t2\n102287\t1\t2\tMar-AF\t5\n101478\t1\t1\tMarried\t4\n101693\t1\t0\tMarried\t3\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create view of customers in descending order of anomaly probability","message":["%script","","CREATE OR REPLACE VIEW EM_ANOMALOUS_RESULTS AS","SELECT * ","FROM (SELECT CUST_ID, anomalous, round(prob_anomalous,2) prob_anomalous, ","             YRS_RESIDENCE, HOUSEHOLD_SIZE, CUST_GENDER,","             CUST_MARITAL_STATUS, ","             RANK() OVER (ORDER BY prob_anomalous DESC) rnk ","      FROM (SELECT CUST_ID, HOUSEHOLD_SIZE, YRS_RESIDENCE, ","                   CUST_GENDER, CUST_MARITAL_STATUS, ","                   prediction(CUSTOMERS360MODEL_AD using *) anomalous,","                   prediction_probability(CUSTOMERS360MODEL_AD, '0' USING *) prob_anomalous","            FROM CUSTOMERS360_V))","ORDER BY prob_anomalous DESC;"," "],"enabled":true,"result":{"startTime":1714398015278,"interpreter":"script.low","endTime":1714398015432,"results":[{"message":"\nView EM_ANOMALOUS_RESULTS created.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View a few rows of the result","message":["%sql","","SELECT * ","FROM   EM_ANOMALOUS_RESULTS","FETCH FIRST 10 ROWS ONLY;"],"enabled":true,"result":{"startTime":1714398015549,"interpreter":"sql.low","endTime":1714398015687,"results":[{"message":"CUST_ID\tANOMALOUS\tPROB_ANOMALOUS\tYRS_RESIDENCE\tHOUSEHOLD_SIZE\tCUST_GENDER\tCUST_MARITAL_STATUS\tRNK\n102926\t0\t1\t2\t4-5\tF\tMarried\t1\n102555\t0\t1\t14\t2\tM\tNeverM\t2\n101693\t0\t1\t0\t4-5\tF\tMarried\t3\n101478\t0\t1\t1\t1\tF\tMarried\t4\n102287\t0\t1\t2\t4-5\tF\tMar-AF\t5\n102258\t0\t1\t9\t2\tF\tNeverM\t6\n103684\t0\t1\t4\t2\tM\tMabsent\t7\n104403\t0\t1\t1\t1\tF\tMarried\t8\n102689\t0\t1\t6\t9+\tM\tDivorc.\t9\n102363\t0\t1\t3\t1\tF\tMarried\t10\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":0,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View prediction details of top 3 attributes to explain prediction","message":["%sql","","SELECT CUST_ID, PREDICTION,","       RTRIM(TRIM(SUBSTR(OUTPRED.\"Attribute1\",17,100)),'rank=\"1\"/>') FIRST_ATTRIBUTE,","       RTRIM(TRIM(SUBSTR(OUTPRED.\"Attribute2\",17,100)),'rank=\"2\"/>') SECOND_ATTRIBUTE","FROM (SELECT CUST_ID, ","             PREDICTION(CUSTOMERS360MODEL_AD USING *) PREDICTION,","             PREDICTION_DETAILS(CUSTOMERS360MODEL_AD, '0' USING *) PREDICTION_DETAILS ","      FROM   CUSTOMERS360_V","      WHERE  PREDICTION_PROBABILITY(CUSTOMERS360MODEL_AD, '0' USING *) > 0.50","      AND    OCCUPATION = 'TechSup'","      ORDER BY CUST_ID) OUT,","      XMLTABLE('/Details'","                PASSING OUT.PREDICTION_DETAILS","                COLUMNS ","                   \"Attribute1\" XMLType PATH 'Attribute[1]',","                   \"Attribute2\" XMLType PATH 'Attribute[2]') OUTPRED","FETCH FIRST 10 ROWS ONLY;"],"enabled":true,"result":{"startTime":1714398015799,"interpreter":"sql.low","endTime":1714398016374,"results":[{"message":"CUST_ID\tPREDICTION\tFIRST_ATTRIBUTE\tSECOND_ATTRIBUTE\n100061\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1959\" weight=\".466\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.036\" \n100646\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1941\" weight=\".794\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.053\" \n100941\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1948\" weight=\".539\" \t\"EDUCATION\" actualValue=\"9th\" weight=\"-.371\" \n101097\t0\t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.001\" \t\"YRS_RESIDENCE\" actualValue=\"6\" weight=\"-.001\" \n101706\t0\t\t\n101970\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1973\" weight=\".315\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.013\" \n102862\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1952\" weight=\"-.022\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.024\" \n102907\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1939\" weight=\".637\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.025\" \n103341\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1959\" weight=\".506\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.048\" \n103441\t0\t\"CUST_YEAR_OF_BIRTH\" actualValue=\"1941\" weight=\".401\" \t\"Y_BOX_GAMES\" actualValue=\"0\" weight=\"-.008\" \n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## End of Script"],"enabled":true,"result":{"startTime":1714398017171,"interpreter":"md.low","endTime":1714398017604,"results":[{"message":"<h2 id=\"end-of-script\">End of Script<\/h2>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":[],"enabled":true,"result":{"startTime":1714398017748,"interpreter":"md.low","endTime":1714398017826,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]