{"paragraphs":[{"text":"%md\n## OML4Py Data Cleaning: fill in missing data\nIn this notebook, we demonstrate how to fill in missing values using OML4Py.\n\nWe use the customer insurance lifetime value data set which contains customer financial information, lifetime value, and whether or not the customer bought insurance.\nThe dataset CUSTOMER_INSURANCE_LTV_PY has missing values artificially generated by “OML4SQL Noise” notebook, which ***must*** be run before this notebook.\n\n**Note**: when building or applying a model using in-database Oracle Machine Learning algorithms, this operation may *not* be needed separately if automatic data preparation is enabled. Automatic data preparation automatically replaces missing values of numerical attributes with the mean and missing values of categorical attributes with the mode. For example, see [GLM model](https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/21/dmcon/generalized-linear-model.html).\n\n\nCopyright (c) 2020 Oracle Corporation                             \n###### [The Universal Permissive License (UPL), Version 1.0](https://oss.oracle.com/licenses/upl/)","user":"OMLUSER","dateUpdated":"2021-01-06T16:47:17+0000","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","fontSize":9,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>OML4Py Data Cleaning: fill in missing data</h2>\n<p>In this notebook, we demonstrate how to fill in missing values using OML4Py.</p>\n<p>We use the customer insurance lifetime value data set which contains customer financial information, lifetime value, and whether or not the customer bought insurance.\n<br  />The dataset CUSTOMER_INSURANCE_LTV_PY has missing values artificially generated by “OML4SQL Noise” notebook, which <strong><em>must</em></strong> be run before this notebook.</p>\n<p><strong>Note</strong>: when building or applying a model using in-database Oracle Machine Learning algorithms, this operation may <em>not</em> be needed separately if automatic data preparation is enabled. Automatic data preparation automatically replaces missing values of numerical attributes with the mean and missing values of categorical attributes with the mode. For example, see <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/21/dmcon/generalized-linear-model.html\">GLM model</a>.</p>\n<p>Copyright (c) 2020 Oracle Corporation</p>\n<h6><a href=\"https://oss.oracle.com/licenses/upl/\">The Universal Permissive License (UPL), Version 1.0</a></h6>\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-1378799152","id":"20201217-193925_1986246785","dateCreated":"2020-12-16T01:16:23+0000","dateStarted":"2021-01-06T16:47:17+0000","dateFinished":"2021-01-06T16:47:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"focus":true,"$$hashKey":"object:40"},{"title":"For more information ...","text":"%md\n\nOML4Py data preparation <https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/1/mlpug/about-preparing-data.html>","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:10+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown","title":true,"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>OML4Py data preparation <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/1/mlpug/about-preparing-data.html\">https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/1/mlpug/about-preparing-data.html</a></p>\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_1065259168","id":"20201217-193925_512126304","dateCreated":"2020-12-17T18:28:27+0000","dateStarted":"2021-01-06T16:02:10+0000","dateFinished":"2021-01-06T16:02:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:41"},{"title":"Import libraries and set display options","text":"%python\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport pandas as pd\nimport oml\nfrom oml import automl\n\npd.set_option('display.max_rows', 500)\npd.set_option('display.max_columns', 500)\npd.set_option('display.width', 1000)","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:10+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"interrupted":false,"jobName":"paragraph_1608233965662_1724547448","id":"20201217-193925_1644201296","dateCreated":"2020-12-16T01:16:53+0000","dateStarted":"2021-01-06T16:02:11+0000","dateFinished":"2021-01-06T16:02:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:42"},{"title":"Get proxy object for CUSTOMER_INSURANCE_LTV_PY table","text":"%python\n\nCUST_DF = oml.sync(schema = 'OMLUSER', table = 'CUSTOMER_INSURANCE_LTV_PY')","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:17+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"interrupted":false,"jobName":"paragraph_1608233965662_532117939","id":"20201217-193925_1791251232","dateCreated":"2020-12-16T01:17:38+0000","dateStarted":"2021-01-06T16:02:18+0000","dateFinished":"2021-01-06T16:02:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:43"},{"title":"Data Overview","text":"%python\n\nz.show(CUST_DF.head())","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:18+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"MARITAL_STATUS":"string","STATE":"string","CREDIT_BALANCE":"string","CUSTOMER_TENURE":"string","MORTGAGE_AMOUNT":"string","BANK_FUNDS":"string","NUM_DEPENDENTS":"string","HAS_CHILDREN":"string","INCOME":"string","CUSTOMER_ID":"string","GENDER":"string","PROFESSION":"string","CREDIT_CARD_LIMITS":"string","REGION":"string","HOME_OWNERSHIP":"string","NUM_ONLINE_TRANS":"string","BUY_INSURANCE":"string","MONTHLY_CHECKS":"string","NUM_TRANS_KIOSK":"string","AGE":"string","MONEY_MONTLY_OVERDRAWN":"string","LTV":"string","TOTAL_AUTOM_PAYMENTS":"string","NUM_TRANS_TELLER":"string","CHECKING_BALANCE":"string","NUM_TRANS_ATM":"string","LTV_BIN":"string","FIRST_NAME":"string","NUM_MORTGAGES":"string","CAR_OWNERSHIP":"string","LAST_NAME":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"MARITAL_STATUS\tSTATE\tCREDIT_BALANCE\tCUSTOMER_TENURE\tMORTGAGE_AMOUNT\tBANK_FUNDS\tNUM_DEPENDENTS\tHAS_CHILDREN\tINCOME\tCUSTOMER_ID\tGENDER\tPROFESSION\tCREDIT_CARD_LIMITS\tREGION\tHOME_OWNERSHIP\tNUM_ONLINE_TRANS\tBUY_INSURANCE\tMONTHLY_CHECKS\tNUM_TRANS_KIOSK\tAGE\tMONEY_MONTLY_OVERDRAWN\tLTV\tTOTAL_AUTOM_PAYMENTS\tNUM_TRANS_TELLER\tCHECKING_BALANCE\tNUM_TRANS_ATM\tLTV_BIN\tFIRST_NAME\tNUM_MORTGAGES\tCAR_OWNERSHIP\tLAST_NAME\nMARRIED\tMI                        \t0\t1\t8320\t11050\t1\t1\t72308\tCU8665                    \tF                         \tDentist\t4000\tMidwest\t1\t1700\tYes\t14\t1\t33\t53.97\t24877.0\t650\t4\t25\t5\tHIGH\tMARGRET\t1\t1\tRYAN\nMARRIED\tMI                        \t0\t1\t1000\t0\t1\t1\t64710\tCU8666                    \tM                         \tIT Staff\t700\tMidwest\t1\t1000\tNo\t4\t1\t38\t53.17\t23477.5\t383\t0\t374\t2\tHIGH\tJOAN\t1\t1\tBAUER\nDIVORCED\tNC                        \t0\t4\t4000\t8800\t6\t1\t61332\tCU9108                    \tF                         \tPROF-15\t800\tSouth\t1\t1600\tYes\t1\t1\t66\t54.97\t16933.0\t1923\t4\t25\t5\tMEDIUM\tMARGART\t1\t1\tCALDWELL\nMARRIED\tTX                        \t0\t3\t845\t450\t3\t1\t62061\tCU9113                    \tM                         \tProgrammer/Developer\t1500\tSouthwest\t1\t845\tYes\t8\t6\t26\t53.01\t18615.25\t226\t2\t25\t2\tMEDIUM\tNICKY\t1\t1\tBARON\nSINGLE\tNV                        \t0\t2\t0\t0\t0\t0\t74394\tCU9114                    \tM                         \tSales Representative\t1500\tSouthwest\t0\t0\tNo\t0\t1\t0\t53.06\t0.0\t0\t0\t25\t0\tLOW\tHUNG\t0\t0\tFINNEY\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-237795672","id":"20201217-193925_17324361","dateCreated":"2020-12-16T01:19:40+0000","dateStarted":"2021-01-06T16:02:19+0000","dateFinished":"2021-01-06T16:02:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:44"},{"title":"The columns MARITAL_STATUS,  CREDIT_BALANCE,  BANK_FUNDS, INCOME have values missing","text":"%python\n\nz.show(CUST_DF[CUST_DF['CUSTOMER_ID'] < 'CU2'][['CUSTOMER_ID','MARITAL_STATUS', 'CREDIT_BALANCE', 'BANK_FUNDS', 'INCOME']].head())","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:19+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"CUSTOMER_ID":"string","MARITAL_STATUS":"string","CREDIT_BALANCE":"string","BANK_FUNDS":"string","INCOME":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"CUSTOMER_ID\tMARITAL_STATUS\tCREDIT_BALANCE\tBANK_FUNDS\tINCOME\nCU12664                   \tNone\tNone\tNone\tNone\nCU12666                   \tNone\tNone\tNone\tNone\nCU12667                   \tNone\tNone\tNone\tNone\nCU12668                   \tNone\tNone\tNone\tNone\nCU12669                   \tNone\tNone\tNone\tNone\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-763932153","id":"20201217-193925_742967653","dateCreated":"2020-12-16T01:18:12+0000","dateStarted":"2021-01-06T16:02:20+0000","dateFinished":"2021-01-06T16:02:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:45"},{"title":"Find mode for the categorical column MARITAL_STATUS","text":"%python\n\ndef col_mode(DF, col):\n    SUMMARY_DF = CUST_DF.dropna().crosstab([col]).sort_values('count').tail(1)\n    return SUMMARY_DF.pull()[col].values[0]\n\nmode = col_mode(CUST_DF, 'MARITAL_STATUS')\n\nprint(mode)\n     ","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:20+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"SINGLE\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-1587439017","id":"20201217-193925_1250223033","dateCreated":"2020-12-16T01:23:34+0000","dateStarted":"2021-01-06T16:02:21+0000","dateFinished":"2021-01-06T16:02:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:46"},{"title":"Replace None with 'SINGLE' and then check the counts","text":"%python\n\nCUST_CAT_DF = CUST_DF.replace(old = [None], new = [mode], columns = ['MARITAL_STATUS'])    \n\nz.show(CUST_CAT_DF.crosstab('MARITAL_STATUS'))\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:21+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"MARITAL_STATUS":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"MARITAL_STATUS\tcount\nDIV\t337\nDIVORCED\t2135\nM\t357\nMARRIED\t2475\nOTHER\t99\nSINGLE\t8973\nWIDOWED\t504\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-695678766","id":"20201217-193925_34731162","dateCreated":"2020-12-16T01:18:49+0000","dateStarted":"2021-01-06T16:02:22+0000","dateFinished":"2021-01-06T16:02:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:47"},{"title":"Replace the missing numerical columns using the mean value","text":"%python\n\nnum_cols = ['CREDIT_BALANCE', 'BANK_FUNDS', 'INCOME']\n\nmean_vals = [ float(CUST_DF[col].mean()) for col in num_cols]\nCUST_NUM_DF = CUST_DF\n\nprint(mean_vals)\nfor i, col in enumerate(num_cols):\n    CUST_NUM_DF = CUST_NUM_DF.replace(old = [None], new = [mean_vals[i]], columns = [col])    \n\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:29+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[3928.787632508834, 3461.4565371024737, 65024.934157832744]\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-543976813","id":"20201217-193925_1091577728","dateCreated":"2020-12-16T01:22:57+0000","dateStarted":"2021-01-06T16:02:30+0000","dateFinished":"2021-01-06T16:02:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:48"},{"title":"Show the OML data frame after the replacement","text":"%python\n\nz.show(CUST_NUM_DF[CUST_NUM_DF['CUSTOMER_ID'] <'CU2'][ ['CUSTOMER_ID'] + num_cols].head())\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:48+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"CUSTOMER_ID":"string","CREDIT_BALANCE":"string","BANK_FUNDS":"string","INCOME":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"CUSTOMER_ID\tCREDIT_BALANCE\tBANK_FUNDS\tINCOME\nCU12664                   \t3928.787632508834\t3461.4565371024737\t65024.934157832744\nCU12666                   \t3928.787632508834\t3461.4565371024737\t65024.934157832744\nCU12667                   \t3928.787632508834\t3461.4565371024737\t65024.934157832744\nCU12668                   \t3928.787632508834\t3461.4565371024737\t65024.934157832744\nCU12669                   \t3928.787632508834\t3461.4565371024737\t65024.934157832744\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_-580252314","id":"20201217-193925_729406758","dateCreated":"2020-12-16T02:33:07+0000","dateStarted":"2021-01-06T16:02:48+0000","dateFinished":"2021-01-06T16:02:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:49"},{"text":"%md\n\n# End of Script\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>End of Script</h1>\n"}]},"interrupted":false,"jobName":"paragraph_1608233965662_1120876212","id":"20201217-193925_1175288539","dateCreated":"2020-12-16T02:38:01+0000","dateStarted":"2021-01-06T16:02:50+0000","dateFinished":"2021-01-06T16:02:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:50"},{"text":"%md\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:02:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"interrupted":false,"jobName":"paragraph_1608233965662_-1865494195","id":"20201217-193925_1261822884","dateCreated":"2020-12-16T02:44:46+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:51"}],"name":"OML4Py Data Cleaning Missing Data","id":"684403","noteParams":{},"noteForms":{},"angularObjects":{"ORACED2F65282:shared_process":[],"ORA3594E6BC19:shared_process":[],"ORA9D573F9398:shared_process":[],"MDW381939C745:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}