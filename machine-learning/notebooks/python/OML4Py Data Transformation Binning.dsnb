[{"layout":null,"template":null,"templateConfig":null,"name":"OML4Py Data Transformation Binning","description":null,"readOnly":false,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":[],"enabled":true,"result":{"startTime":1715292123840,"interpreter":"md.low","endTime":1715292123927,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":true,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# OML4Py Data Transformation: Binning","In this notebook, we demonstrate how to bin numerical columns using OML4Py. Equi-width and quantile binning are shown. ","","We use the customer insurance lifetime value data set which contains customer financial information, lifetime value, and whether or not the customer bought insurance.","","We show how to bin a numerical column and visualize the distribution.","","The dataset `CUSTOMER_INSURANCE_LTV` is generated by the `\"OML Run-me-first\"` notebook, which `MUST` be run before this notebook.","","---","","##### IMPORTANT: The `\"OML Run-me-first\"` notebook is available under the menu `Templates -> Examples` and is a pre-requisite to the current notebook.","","---","","","**Note**: If the user plans to use the in-database Naive Bayes algorithm later, Automatic Data Preparation (ADP) performs supervised binning. ","Supervised binning uses decision trees to create optimal bin boundaries. ","More details can be found in <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmcon/naive-bayes.html\" onclick=\"return ! window.open('https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmcon/naive-bayes.html');\">Naive Bayes<\/a>  ","","Copyright (c) 2024 Oracle Corporation ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" onclick=\"return ! window.open('https://oss.oracle.com/licenses/upl/');\">The Universal Permissive License (UPL), Version 1.0<\/a>","---"],"enabled":true,"result":{"startTime":1715292124000,"interpreter":"md.low","endTime":1715292124109,"results":[{"message":"<h1 id=\"oml4py-data-transformation-binning\">OML4Py Data Transformation: Binning<\/h1>\n<p>In this notebook, we demonstrate how to bin numerical columns using OML4Py. Equi-width and quantile binning are shown.<\/p>\n<p>We use the customer insurance lifetime value data set which contains customer financial information, lifetime value, and whether or not the customer bought insurance.<\/p>\n<p>We show how to bin a numerical column and visualize the distribution.<\/p>\n<p>The dataset <code>CUSTOMER_INSURANCE_LTV<\/code> is generated by the <code>&quot;OML Run-me-first&quot;<\/code> notebook, which <code>MUST<\/code> be run before this notebook.<\/p>\n<hr />\n<h5 id=\"important-the-oml-run-me-first-notebook-is-available-under-the-menu-templates---examples-and-is-a-pre-requisite-to-the-current-notebook\">IMPORTANT: The <code>&quot;OML Run-me-first&quot;<\/code> notebook is available under the menu <code>Templates -&gt; Examples<\/code> and is a pre-requisite to the current notebook.<\/h5>\n<hr />\n<p><strong>Note<\/strong>: If the user plans to use the in-database Naive Bayes algorithm later, Automatic Data Preparation (ADP) performs supervised binning.\nSupervised binning uses decision trees to create optimal bin boundaries.\nMore details can be found in <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmcon/naive-bayes.html\" onclick=\"return ! window.open('https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmcon/naive-bayes.html');\">Naive Bayes<\/a><\/p>\n<p>Copyright (c) 2024 Oracle Corporation<\/p>\n<h6 id=\"the-universal-permissive-license-upl-version-10\"><a href=\"https://oss.oracle.com/licenses/upl/\" onclick=\"return ! window.open('https://oss.oracle.com/licenses/upl/');\">The Universal Permissive License (UPL), Version 1.0<\/a><\/h6>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information ...","message":["%md","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADW Documentation<\/a>","* <a href=\"https://github.com/oracle/oracle-db-examples/tree/master/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a>","* <a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a>","* <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/summarize-data.html\" target=\"_blank\">OML4Py Data Summarization<\/a>"],"enabled":true,"result":{"startTime":1715292124187,"interpreter":"md.low","endTime":1715292124264,"results":[{"message":"<ul>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADW Documentation<\/a><\/li>\n<li><a href=\"https://github.com/oracle/oracle-db-examples/tree/master/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a><\/li>\n<li><a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/summarize-data.html\" target=\"_blank\">OML4Py Data Summarization<\/a><\/li>\n<\/ul>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Import python libraries and set display options","message":["%python","","import warnings","warnings.filterwarnings('ignore')","","import pandas as pd","import oml","from oml import automl"],"enabled":true,"result":{"startTime":1715292124340,"interpreter":"python.low","endTime":1715292126443,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Get a proxy object to CUSTOMER_INSURANCE_LTV and view data","message":["%python","","CUST_DF = oml.sync(table = 'CUSTOMER_INSURANCE_LTV')","","z.show(CUST_DF.head())"],"enabled":true,"result":{"startTime":1715292126518,"interpreter":"python.low","endTime":1715292126897,"results":[{"message":"MARITAL_STATUS\tSTATE\tCREDIT_BALANCE\tCUSTOMER_TENURE\tMORTGAGE_AMOUNT\tBANK_FUNDS\tNUM_DEPENDENTS\tHAS_CHILDREN\tINCOME\tCUSTOMER_ID\tGENDER\tPROFESSION\tCREDIT_CARD_LIMITS\tREGION\tHOME_OWNERSHIP\tNUM_ONLINE_TRANS\tBUY_INSURANCE\tMONTHLY_CHECKS\tNUM_TRANS_KIOSK\tAGE\tMONEY_MONTLY_OVERDRAWN\tLTV\tTOTAL_AUTOM_PAYMENTS\tNUM_TRANS_TELLER\tCHECKING_BALANCE\tNUM_TRANS_ATM\tLTV_BIN\tFIRST_NAME\tNUM_MORTGAGES\tCAR_OWNERSHIP\tLAST_NAME\nSINGLE\tCA                        \t0\t3\t0\t0\t3\t0\t65871\tCU15154                   \tM                         \tNurse\t1000\tWest\t0\t0\tNo\t0\t1\t24\t53.06\t14367.75\t0\t0\t25\t0\tMEDIUM\tGAYLE\t0\t0\tDURANT\nSINGLE\tNY                        \t0\t4\t0\t290\t4\t0\t68747\tCU15155                   \tM                         \tProgrammer/Developer\t700\tNorthEast\t0\t0\tYes\t1\t1\t35\t53.84\t14686.75\t287\t2\t25\t4\tMEDIUM\tQUINTON\t0\t1\tMASSEY\nMARRIED\tMI                        \t0\t3\t1000\t550\t3\t0\t68684\tCU15157                   \tM                         \tProgrammer/Developer\t1000\tMidwest\t1\t1000\tYes\t14\t1\t26\t53.48\t25271.0\t132\t2\t25\t4\tHIGH\tANIBAL\t1\t1\tJIMENEZ\nMARRIED\tUT                        \t0\t5\t1200\t1000\t5\t0\t59354\tCU15286                   \tF                         \tFireman\t2500\tSouthwest\t1\t1200\tNo\t4\t5\t24\t53.08\t19738.5\t628\t3\t619\t1\tMEDIUM\tJUNITA\t1\t1\tROBERTSON\nMARRIED\tUT                        \t0\t4\t1800\t0\t3\t0\t84801\tCU15287                   \tF                         \tPROF-26\t2500\tSouthwest\t1\t1800\tNo\t0\t5\t47\t53.06\t31900.25\t0\t0\t25\t0\tVERY HIGH\tCHASITY\t1\t1\tELLIS\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Bin INCOME column into 10 bins","message":["%python","","CUST_BIN_DF = CUST_DF.concat(CUST_DF['INCOME'].cut(bins = 10))"],"enabled":true,"result":{"startTime":1715292126976,"interpreter":"python.low","endTime":1715292127203,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"table\":{\"version\":1},\"bar\":{\"aggregationOption\":\"Count\",\"series\":{\"availableSeriesElements\":[{\"id\":\"INCOME\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0}]},\"lastColumns\":[\"INCOME\",\"Bin(INCOME)\"],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"table","title":"View binned INCOME column values","message":["%python","","z.show(CUST_BIN_DF[['INCOME', 'Bin(INCOME)']].head())"],"enabled":true,"result":{"startTime":1715292127277,"interpreter":"python.low","endTime":1715292127429,"results":[{"message":"INCOME\tBin(INCOME)\n65871\t(59456.4, 66906.2]\n68747\t(66906.2, 74356.0]\n68684\t(66906.2, 74356.0]\n59354\t(52006.6, 59456.4]\n84801\t(81805.8, 89255.6]\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"bar\":{\"aggregationOption\":\"Last\",\"series\":{\"availableSeriesElements\":[{\"id\":\"count_l\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0}]},\"lastColumns\":[\"Bin(INCOME)\",\"count_l\",\"mean(INCOME)_r\"],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"bar","title":"Plot the distribution of binned INCOME","message":["%python","","INCOME_MEAN = CUST_BIN_DF.crosstab('Bin(INCOME)', values = 'INCOME', aggfunc = oml.DataFrame.mean).sort_values('mean(INCOME)')","","OUTPUT = CUST_BIN_DF.crosstab('Bin(INCOME)').merge(INCOME_MEAN, on = 'Bin(INCOME)').sort_values('mean(INCOME)_r')","","z.show(OUTPUT)"],"enabled":true,"result":{"startTime":1715292127509,"interpreter":"python.low","endTime":1715292128159,"results":[{"message":"Bin(INCOME)\tcount_l\tmean(INCOME)_r\n(37032.502, 44556.8]\t23\t41487.217391304344\n(44556.8, 52006.6]\t134\t48909.5\n(52006.6, 59456.4]\t2070\t57577.33381642512\n(59456.4, 66906.2]\t7053\t63166.39472564866\n(66906.2, 74356.0]\t3651\t69725.86469460421\n(74356.0, 81805.8]\t636\t76719.74056603774\n(81805.8, 89255.6]\t179\t84790.54189944133\n(89255.6, 96705.4]\t84\t92527.70238095238\n(96705.4, 104155.2]\t32\t100052.25\n(104155.2, 111605.0]\t18\t108535.5\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Get quantiles for INCOME column","message":["%python","","CUST_DF['INCOME'].describe()[-5:]"],"enabled":true,"result":{"startTime":1715292128238,"interpreter":"python.low","endTime":1715292128390,"results":[{"message":"min     37107.0\n25%     60719.5\n50%     64426.0\n75%     68482.0\nmax    111605.0\nName: INCOME, dtype: float64\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":5,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"bar\":{\"series\":{\"availableSeriesElements\":[{\"id\":\"count\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0}]},\"lastColumns\":[\"Bin(INCOME)\",\"count\"],\"version\":1},\"area\":{\"version\":1},\"tree\":{},\"pyramid\":{\"version\":1},\"boxplot\":{}}]","hideInIFrame":false,"selectedVisualization":"bar","title":"Use quantiles for bin boundaries","message":["%python","","pct = CUST_DF['INCOME'].describe(percentiles = [0.25, 0.5, 0.75])[-5:]","","pct_list = list(pct)","pct_list.sort()","CUST_SET_DF = CUST_DF.concat(CUST_DF['INCOME'].cut(bins = pct_list))","","OUTPUT = CUST_SET_DF.crosstab('Bin(INCOME)')","z.show(OUTPUT[OUTPUT['Bin(INCOME)'].isnull() == False])"],"enabled":true,"result":{"startTime":1715292128469,"interpreter":"python.low","endTime":1715292128913,"results":[{"message":"Bin(INCOME)\tcount\n(37107.0, 60719.5]\t3469\n(60719.5, 64426.0]\t3470\n(64426.0, 68482.0]\t3472\n(68482.0, 111605.0]\t3468\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":7,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## End of Script"],"enabled":true,"result":{"startTime":1715292128993,"interpreter":"md.low","endTime":1715292129055,"results":[{"message":"<h2 id=\"end-of-script\">End of Script<\/h2>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":[],"enabled":true,"result":{"startTime":1715292129149,"interpreter":"md.low","endTime":1715292129212,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":null,"row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]