{"paragraphs":[{"text":"%md\n## OML4Py Data Transformation: Binning\nIn this notebook, we demonstrate how to bin numerical columns using OML4Py. Equi-width and quantile binning are shown. \n\nWe use the customer insurance lifetime value data set which contains customer financial information, lifetime value, and whether or not the customer bought insurance.\n\nWe show how to bin a numerical column and visualize the distribution.\n\n**Note**: If the user plans to use the in-database Naive Bayes algorithm later, Automatic Data Preparation (ADP) performs supervised binning. Supervised binning uses decision trees to create optimal bin boundaries. More details can be found in [Naive Bayes](https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/21/dmcon/naive-bayes.html#GUID-FD929CF9-6513-42DE-B04D-FD57310C3A04)\n\nCopyright (c) 2020 Oracle Corporation                             \n###### [The Universal Permissive License (UPL), Version 1.0](https://oss.oracle.com/licenses/upl/)\n---","user":"OMLUSER","dateUpdated":"2021-01-06T16:58:33+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h2>OML4Py Data Transformation: Binning</h2>\n<p>In this notebook, we demonstrate how to bin numerical columns using OML4Py. Equi-width and quantile binning are shown.</p>\n<p>We use the customer insurance lifetime value data set which contains customer financial information, lifetime value, and whether or not the customer bought insurance.</p>\n<p>We show how to bin a numerical column and visualize the distribution.</p>\n<p><strong>Note</strong>: If the user plans to use the in-database Naive Bayes algorithm later, Automatic Data Preparation (ADP) performs supervised binning. Supervised binning uses decision trees to create optimal bin boundaries. More details can be found in <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/21/dmcon/naive-bayes.html#GUID-FD929CF9-6513-42DE-B04D-FD57310C3A04\">Naive Bayes</a></p>\n<p>Copyright (c) 2020 Oracle Corporation</p>\n<h6><a href=\"https://oss.oracle.com/licenses/upl/\">The Universal Permissive License (UPL), Version 1.0</a></h6>\n<hr />\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_-2003379684","id":"20201217-193925_500733903","dateCreated":"2020-12-15T19:07:35+0000","dateStarted":"2021-01-06T16:58:33+0000","dateFinished":"2021-01-06T16:58:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"focus":true,"$$hashKey":"object:22"},{"title":"For more information ...","text":"%md\n\nOML4Py summarize data <https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/1/mlpug/summarize-data.html>","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:31+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown","title":true,"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>OML4Py summarize data <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/1/mlpug/summarize-data.html\">https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/1/mlpug/summarize-data.html</a></p>\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_1844047095","id":"20201217-193925_998538084","dateCreated":"2020-12-17T18:55:41+0000","dateStarted":"2021-01-06T16:55:32+0000","dateFinished":"2021-01-06T16:55:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:23"},{"title":"Import python libraries and set display options","text":"%python\n\nimport warnings\nwarnings.filterwarnings('ignore')\n\nimport pandas as pd\nimport oml\nfrom oml import automl\n\npd.set_option('display.max_rows', 500)\npd.set_option('display.max_columns', 500)\npd.set_option('display.width', 1000)","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:32+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"interrupted":false,"jobName":"paragraph_1608233965438_847389206","id":"20201217-193925_1804986113","dateCreated":"2020-11-29T03:39:14+0000","dateStarted":"2021-01-06T16:55:32+0000","dateFinished":"2021-01-06T16:55:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:24"},{"title":"Get a proxy object to CUSTOMER_INSURANCE_LTV","text":"%python\n\nCUST_DF = oml.sync(schema = 'OMLUSER', table = 'CUSTOMER_INSURANCE_LTV')","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:39+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"interrupted":false,"jobName":"paragraph_1608233965438_-828804706","id":"20201217-193925_1497096061","dateCreated":"2020-11-29T03:39:54+0000","dateStarted":"2021-01-06T16:55:39+0000","dateFinished":"2021-01-06T16:55:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:25"},{"title":"Data overview","text":"%python\n\nz.show(CUST_DF.head())","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:40+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"MARITAL_STATUS":"string","STATE":"string","CREDIT_BALANCE":"string","CUSTOMER_TENURE":"string","MORTGAGE_AMOUNT":"string","BANK_FUNDS":"string","NUM_DEPENDENTS":"string","HAS_CHILDREN":"string","INCOME":"string","CUSTOMER_ID":"string","GENDER":"string","PROFESSION":"string","CREDIT_CARD_LIMITS":"string","REGION":"string","HOME_OWNERSHIP":"string","NUM_ONLINE_TRANS":"string","BUY_INSURANCE":"string","MONTHLY_CHECKS":"string","NUM_TRANS_KIOSK":"string","AGE":"string","MONEY_MONTLY_OVERDRAWN":"string","LTV":"string","TOTAL_AUTOM_PAYMENTS":"string","NUM_TRANS_TELLER":"string","CHECKING_BALANCE":"string","NUM_TRANS_ATM":"string","LTV_BIN":"string","FIRST_NAME":"string","NUM_MORTGAGES":"string","CAR_OWNERSHIP":"string","LAST_NAME":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"MARITAL_STATUS\tSTATE\tCREDIT_BALANCE\tCUSTOMER_TENURE\tMORTGAGE_AMOUNT\tBANK_FUNDS\tNUM_DEPENDENTS\tHAS_CHILDREN\tINCOME\tCUSTOMER_ID\tGENDER\tPROFESSION\tCREDIT_CARD_LIMITS\tREGION\tHOME_OWNERSHIP\tNUM_ONLINE_TRANS\tBUY_INSURANCE\tMONTHLY_CHECKS\tNUM_TRANS_KIOSK\tAGE\tMONEY_MONTLY_OVERDRAWN\tLTV\tTOTAL_AUTOM_PAYMENTS\tNUM_TRANS_TELLER\tCHECKING_BALANCE\tNUM_TRANS_ATM\tLTV_BIN\tFIRST_NAME\tNUM_MORTGAGES\tCAR_OWNERSHIP\tLAST_NAME\nMARRIED\tNY                        \t63\t3\t1200\t750\t3\t1\t58261\tCU14048                   \tM                         \tPROF-3\t1500\tNorthEast\t1\t1200\tNo\t15\t1\t33\t53.38\t18365.25\t4364\t3\t3879\t3\tMEDIUM\tERIN\t1\t1\tTYSON\nMARRIED\tNV                        \t0\t3\t1091\t1400\t3\t0\t68632\tCU14049                   \tM                         \tWaiter/Waitress\t1000\tSouthwest\t1\t1091\tYes\t10\t1\t27\t53.02\t25358.0\t510\t3\t25\t2\tHIGH\tDALLAS\t1\t1\tMACDONALD\nSINGLE\tMI                        \t0\t4\t0\t0\t0\t1\t59234\tCU14050                   \tM                         \tAdministrative Assistant\t600\tMidwest\t0\t0\tNo\t5\t1\t38\t52.97\t15608.5\t1203\t0\t25\t2\tMEDIUM\tDARIN\t0\t1\tKILGORE\nOTHER\tTX                        \t0\t1\t15000\t11800\t1\t1\t67748\tCU4614                    \tF                         \tClerical\t1600\tSouthwest\t1\t5000\tNo\t2\t3\t37\t54.2\t24137.0\t4096\t2\t25\t5\tHIGH\tREINA\t1\t1\tCRISP\nSINGLE\tMN                        \t0\t1\t319\t0\t1\t1\t57734\tCU4615                    \tM                         \tProgrammer/Developer\t900\tWest\t1\t319\tNo\t0\t3\t27\t53.06\t20633.5\t507\t1\t25\t0\tMEDIUM\tCOLEMAN\t1\t1\tNICHOLSON\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_-639341668","id":"20201217-193925_281978","dateCreated":"2020-11-29T03:40:15+0000","dateStarted":"2021-01-06T16:55:40+0000","dateFinished":"2021-01-06T16:55:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:26"},{"title":"Bin the INCOME column into 10 segments","text":"%python\n\nCUST_BIN_DF = CUST_DF.concat(CUST_DF['INCOME'].cut(bins = 10))","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:41+0000","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"interrupted":false,"jobName":"paragraph_1608233965438_539655130","id":"20201217-193925_415455557","dateCreated":"2020-11-29T03:40:26+0000","dateStarted":"2021-01-06T16:55:41+0000","dateFinished":"2021-01-06T16:55:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:27"},{"title":"Sample view of the binned column","text":"%python\n\nz.show(CUST_BIN_DF[['INCOME', 'Bin(INCOME)']].head())","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:42+0000","config":{"colWidth":6,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":204,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"INCOME":"string","Bin(INCOME)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"INCOME\tBin(INCOME)\n58261\t(52006.6, 59456.4]\n68632\t(66906.2, 74356.0]\n59234\t(52006.6, 59456.4]\n67748\t(66906.2, 74356.0]\n57734\t(52006.6, 59456.4]\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_75798836","id":"20201217-193925_1554651315","dateCreated":"2020-11-29T03:41:14+0000","dateStarted":"2021-01-06T16:55:42+0000","dateFinished":"2021-01-06T16:55:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:28"},{"title":"Plot the distribution of binned INCOME","text":"%python\n\nINCOME_MEAN = CUST_BIN_DF.crosstab('Bin(INCOME)', values = 'INCOME', aggfunc = oml.DataFrame.mean).sort_values('mean(INCOME)')\nOUTPUT = CUST_BIN_DF.crosstab('Bin(INCOME)').merge(INCOME_MEAN, on = 'Bin(INCOME)').sort_values('mean(INCOME)_r')\nz.show(OUTPUT)","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:48+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Bin(INCOME)":"string","mean(INCOME)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"Bin(INCOME)","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count_l","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"python","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"Bin(INCOME)\tcount_l\tmean(INCOME)_r\n(37032.502, 44556.8]\t23\t41487.217391304344\n(44556.8, 52006.6]\t134\t48909.5\n(52006.6, 59456.4]\t2070\t57577.33381642512\n(59456.4, 66906.2]\t7053\t63166.39472564866\n(66906.2, 74356.0]\t3651\t69725.86469460421\n(74356.0, 81805.8]\t636\t76719.74056603774\n(81805.8, 89255.6]\t179\t84790.54189944133\n(89255.6, 96705.4]\t84\t92527.70238095238\n(96705.4, 104155.2]\t32\t100052.25\n(104155.2, 111605.0]\t18\t108535.5\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_1103251196","id":"20201217-193925_1533932652","dateCreated":"2020-11-29T03:43:25+0000","dateStarted":"2021-01-06T16:55:43+0000","dateFinished":"2021-01-06T16:55:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:29"},{"title":"Get quantiles for INCOME column","text":"%python\n\nCUST_DF['INCOME'].describe()[-5:]\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:44+0000","config":{"colWidth":5,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"min     37107.0\n25%     60719.5\n50%     64426.0\n75%     68482.0\nmax    111605.0\nName: INCOME, dtype: float64\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_765798669","id":"20201217-193925_2040536550","dateCreated":"2020-12-16T20:57:14+0000","dateStarted":"2021-01-06T16:55:45+0000","dateFinished":"2021-01-06T16:55:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:30"},{"title":"Use quantiles for bin boundaries","text":"%python\n\npct = CUST_DF['INCOME'].describe(percentiles = [0.25, 0.5, 0.75])[-5:]\n\nCUST_SET_DF = CUST_DF.concat(CUST_DF['INCOME'].cut(bins = list(pct)))\n\nOUTPUT = CUST_SET_DF.crosstab('Bin(INCOME)')\nz.show(OUTPUT[OUTPUT['Bin(INCOME)'].isnull() == False])","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:48+0000","config":{"colWidth":7,"fontSize":9,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"Bin(INCOME)":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"Bin(INCOME)","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/undefined","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"Bin(INCOME)\tcount\n(37107.0, 60719.5]\t3469\n(60719.5, 64426.0]\t3470\n(64426.0, 68482.0]\t3472\n(68482.0, 111605.0]\t3468\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_-1198222303","id":"20201217-193925_2074831590","dateCreated":"2020-12-17T03:02:11+0000","dateStarted":"2021-01-06T16:55:46+0000","dateFinished":"2021-01-06T16:55:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:31"},{"text":"%md\n\n# End of Script\n","user":"OMLUSER","dateUpdated":"2021-01-06T16:55:47+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false,"completionSupport":true},"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>End of Script</h1>\n"}]},"interrupted":false,"jobName":"paragraph_1608233965438_1294189632","id":"20201217-193925_2001242784","dateCreated":"2020-11-29T03:48:15+0000","dateStarted":"2021-01-06T16:55:47+0000","dateFinished":"2021-01-06T16:55:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:32"},{"text":"%md\n","user":"OMLUSER","dateUpdated":"2020-12-23T14:18:05+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"md","editOnDblClick":false},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"interrupted":false,"jobName":"paragraph_1608233965438_-1630966280","id":"20201217-193925_1127403185","dateCreated":"2020-12-16T01:01:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"commited":true,"$$hashKey":"object:33"}],"name":"OML4Py Data Transformation Binning","id":"684400","noteParams":{},"noteForms":{},"angularObjects":{"ORACED2F65282:shared_process":[],"ORA3594E6BC19:shared_process":[],"ORA9D573F9398:shared_process":[],"MDW381939C745:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}