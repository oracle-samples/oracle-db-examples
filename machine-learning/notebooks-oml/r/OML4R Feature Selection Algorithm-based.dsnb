[{"layout":null,"template":null,"templateConfig":null,"name":"OML4R Feature Selection Algorithm-based","description":null,"readOnly":false,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":["%md"," "],"enabled":true,"result":{"startTime":1736289518451,"interpreter":"md.low","endTime":1736289518991,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# OML4R Feature Selection: Supervised Algorithm","","In this notebook, we demonstrate how to perform feature selection using in-database supervised algorithms via OML4R.","","Using the customer insurance lifetime value data set, which contains customer financial information, lifetime value, and whether or not the customer bought insurance, we build a random forest model to predict whether the customer by insurance or not, then use feature importance to perform feature selection. ","","The dataset `CUSTOMER_INSURANCE_LTV` is generated by the `\"OML Run-me-first\"` notebook, which `MUST` be run before this notebook.","","---","###### `IMPORTANT`: The `\"OML Run-me-first\"` notebook is available under the menu Templates -> Examples and is a prerequisite to the current notebook.","---","","Copyright (c) 2026 Oracle Corporation ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a>","---"],"enabled":true,"result":{"startTime":1736289519450,"interpreter":"md.low","endTime":1736289519929,"results":[{"message":"<h1 id=\"oml4r-feature-selection-supervised-algorithm\">OML4R Feature Selection: Supervised Algorithm<\/h1>\n<p>In this notebook, we demonstrate how to perform feature selection using in-database supervised algorithms via OML4R.<\/p>\n<p>Using the customer insurance lifetime value data set, which contains customer financial information, lifetime value, and whether or not the customer bought insurance, we build a random forest model to predict whether the customer by insurance or not, then use feature importance to perform feature selection.<\/p>\n<p>The dataset <code>CUSTOMER_INSURANCE_LTV<\/code> is generated by the <code>&quot;OML Run-me-first&quot;<\/code> notebook, which <code>MUST<\/code> be run before this notebook.<\/p>\n<hr />\n<h6 id=\"important-the-oml-run-me-first-notebook-is-available-under-the-menu-templates---examples-and-is-a-prerequisite-to-the-current-notebook\"><code>IMPORTANT<\/code>: The <code>&quot;OML Run-me-first&quot;<\/code> notebook is available under the menu Templates -&gt; Examples and is a prerequisite to the current notebook.<\/h6>\n<hr />\n<p>Copyright (c) 2026 Oracle Corporation<\/p>\n<h6 id=\"the-universal-permissive-license-upl-version-10\"><a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a><\/h6>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information...","message":["%md","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB Documentation<\/a>","* <a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a>","* <a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a>","* <a href=\"https://www.oracle.com/goto/ml-classification\" target=\"_blank\">OML Classification<\/a>","* <a href=\"https://oracle.com/goto/ml-random-forest\" target=\"_blank\">OML Random Forest<\/a>","* <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/random-forest.html\" target=\"_blank\">OML4Py Random Forest<\/a>"],"enabled":true,"result":{"startTime":1736289520396,"interpreter":"md.low","endTime":1736289520849,"results":[{"message":"<ul>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB Documentation<\/a><\/li>\n<li><a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a><\/li>\n<li><a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML Web Page<\/a><\/li>\n<li><a href=\"https://www.oracle.com/goto/ml-classification\" target=\"_blank\">OML Classification<\/a><\/li>\n<li><a href=\"https://oracle.com/goto/ml-random-forest\" target=\"_blank\">OML Random Forest<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/random-forest.html\" target=\"_blank\">OML4Py Random Forest<\/a><\/li>\n<\/ul>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Import libraries and set display options","message":["%r","","library(ORE)","library(lattice)","options(ore.warn.order=FALSE)"],"enabled":true,"result":{"startTime":1736289521305,"interpreter":"r.low","endTime":1736289526284,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Get a proxy object to the CUSTOMER_INSURANCE_LTV table and assign rownames for row indexing","message":["%r","","ore.sync(table = 'CUSTOMER_INSURANCE_LTV', use.keys= TRUE)","ore.attach()","rownames(CUSTOMER_INSURANCE_LTV) <- CUSTOMER_INSURANCE_LTV$CUSTOMER_ID"],"enabled":true,"result":{"startTime":1736289526731,"interpreter":"r.low","endTime":1736289527686,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Display a few rows from CUSTOMER_INSURANCE_LTV table","message":["%r","","z.show(head(CUSTOMER_INSURANCE_LTV))"],"enabled":true,"result":{"startTime":1736289577510,"interpreter":"r.low","endTime":1736289578041,"results":[{"message":"MARITAL_STATUS\tSTATE\tCREDIT_BALANCE\tCUSTOMER_TENURE\tMORTGAGE_AMOUNT\tBANK_FUNDS\tNUM_DEPENDENTS\tHAS_CHILDREN\tINCOME\tCUSTOMER_ID\tGENDER\tPROFESSION\tCREDIT_CARD_LIMITS\tREGION\tHOME_OWNERSHIP\tNUM_ONLINE_TRANS\tBUY_INSURANCE\tMONTHLY_CHECKS\tNUM_TRANS_KIOSK\tAGE\tMONEY_MONTLY_OVERDRAWN\tLTV\tTOTAL_AUTOM_PAYMENTS\tNUM_TRANS_TELLER\tCHECKING_BALANCE\tNUM_TRANS_ATM\tLTV_BIN\tFIRST_NAME\tNUM_MORTGAGES\tCAR_OWNERSHIP\tLAST_NAME\nOTHER\tWA                        \t0\t4\t24250\t26200\t1\t1\t70508\tCU1                       \tF                         \tIT Staff\t900\tWest\t2\t4200\tYes\t1\t0\t59\t61.27\t38527\t8893\t5\t25\t7\tVERY HIGH\tDORRIS\t2\t1\tHOPKINS\nDIVORCED\tMN                        \t57844\t4\t2500\t4350\t6\t1\t68361\tCU10                      \tF                         \tPROF-35\t800\tWest\t1\t750\tNo\t7\t0\t73\t56.01\t19390.25\t60429\t1\t25\t6\tMEDIUM\tDWANA\t1\t1\tWINN\nMARRIED\tNY                        \t0\t1\t1500\t0\t1\t1\t60185\tCU1000                    \tM                         \tNot specified\t500\tNorthEast\t1\t1500\tNo\t1\t0\t35\t53.18\t22046.25\t547\t1\t33\t3\tHIGH\tLANCE\t1\t1\tBURDEN\nMARRIED\tCA                        \t0\t3\t1000\t650\t3\t1\t71740\tCU10000                   \tM                         \tProgrammer/Developer\t1000\tWest\t1\t1000\tYes\t3\t1\t26\t53.61\t21035\t386\t2\t25\t4\tMEDIUM\tELISHA\t1\t1\tHYDE\nDIVORCED\tFL                        \t0\t1\t3000\t0\t1\t0\t68482\tCU10001                   \tM                         \tIT Staff\t1000\tSouth\t1\t3000\tNo\t1\t1\t44\t53.08\t30020.5\t259\t1\t25\t1\tVERY HIGH\tLONNY\t1\t1\tFAIRCHILD\nDIVORCED\tMI                        \t0\t4\t2600\t0\t3\t1\t71016\tCU10003                   \tF                         \tIT Staff\t1000\tMidwest\t1\t2600\tNo\t1\t1\t46\t53.05\t23354\t0\t1\t25\t2\tHIGH\tSHERRYL\t1\t1\tBAGGETT\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Create Train and Test (60/40 split) datasets","message":["%r","","set.seed(2)","sampleSize <- nrow(CUSTOMER_INSURANCE_LTV)*.4","ind <- sample(1:nrow(CUSTOMER_INSURANCE_LTV),sampleSize)","group <- as.integer(1:nrow(CUSTOMER_INSURANCE_LTV) %in% ind)","","CUSTOMER_INSURANCE_LTV.train <- CUSTOMER_INSURANCE_LTV[group==FALSE,]","CUSTOMER_INSURANCE_LTV.test <- CUSTOMER_INSURANCE_LTV[group==TRUE,]"],"enabled":true,"result":{"startTime":1736289589728,"interpreter":"r.low","endTime":1736289590811,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Apply Attribute Importance algorithm to obtain the attribute importance","message":["%r","","ai_mod <- ore.odmAI(BUY_INSURANCE ~., CUSTOMER_INSURANCE_LTV.train)","","ai_mod$importance$variable <- row.names(ai_mod$importance)","z.show(head(ai_mod$importance), 10)"],"enabled":true,"result":{"startTime":1736289596893,"interpreter":"r.low","endTime":1736289598239,"results":[{"message":"importance\trank\tvariable\n0.209333217976261\t1\tBANK_FUNDS\n0.150952228029964\t2\tMONEY_MONTLY_OVERDRAWN\n0.150295332663922\t3\tNUM_TRANS_ATM\n0.11324307283782\t4\tNUM_TRANS_TELLER\n0.111830226045908\t5\tTOTAL_AUTOM_PAYMENTS\n0.0892722533095141\t6\tMONTHLY_CHECKS\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Get the top attributes from Attribute Importance algorithm greater than threshold value","message":["%r","","threshold <- 0.089","features <- rownames(ai_mod$importance)[ai_mod$importance$importance >= threshold]","","z.show(head(ai_mod$importance, n = 10))"],"enabled":true,"result":{"startTime":1736289616610,"interpreter":"r.low","endTime":1736289617082,"results":[{"message":"importance\trank\tvariable\n0.209333217976261\t1\tBANK_FUNDS\n0.150952228029964\t2\tMONEY_MONTLY_OVERDRAWN\n0.150295332663922\t3\tNUM_TRANS_ATM\n0.11324307283782\t4\tNUM_TRANS_TELLER\n0.111830226045908\t5\tTOTAL_AUTOM_PAYMENTS\n0.0892722533095141\t6\tMONTHLY_CHECKS\n0.0259473661529411\t7\tNUM_DEPENDENTS\n0.0190565008234718\t8\tCHECKING_BALANCE\n0.0187666923125637\t9\tCUSTOMER_TENURE\n0.0129675690090682\t10\tPROFESSION\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Include the target variable to attribute vector","message":["%r","","features <- c(features, \"BUY_INSURANCE\")"],"enabled":true,"result":{"startTime":1736289630714,"interpreter":"r.low","endTime":1736289631182,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Create a new ORE Frame with top attributes for predicting the target variable","message":["%r","","DF_NEW <- subset(CUSTOMER_INSURANCE_LTV.train, select = features)","z.show(head(DF_NEW))"],"enabled":true,"result":{"startTime":1736289637130,"interpreter":"r.low","endTime":1736289637719,"results":[{"message":"BANK_FUNDS\tMONEY_MONTLY_OVERDRAWN\tNUM_TRANS_ATM\tNUM_TRANS_TELLER\tTOTAL_AUTOM_PAYMENTS\tMONTHLY_CHECKS\tBUY_INSURANCE\n26200\t61.27\t7\t5\t8893\t1\tYes\n650\t53.61\t4\t2\t386\t3\tYes\n0\t53.08\t1\t1\t259\t1\tNo\n0\t53.05\t2\t1\t0\t1\tNo\n0\t53.06\t0\t1\t0\t0\tNo\n300\t53.13\t2\t2\t198\t10\tYes\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Build a Naive Bayes model to predict who will purchase insurance using the top attributes","message":["%r","","mod <- ore.odmNB(BUY_INSURANCE~., DF_NEW)","mod"],"enabled":true,"result":{"startTime":1736289644107,"interpreter":"r.low","endTime":1736289645650,"results":[{"message":"\nCall:\nore.odmNB(formula = BUY_INSURANCE ~ ., data = DF_NEW)\n\nSettings: \n                                               value\nclas.weights.balanced                            OFF\nodms.details                             odms.enable\nodms.missing.value.treatment odms.missing.value.auto\nodms.sampling                  odms.sampling.disable\nprep.auto                                         ON","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## End of script"],"enabled":true,"result":{"startTime":1736289650359,"interpreter":"md.low","endTime":1736289650800,"results":[{"message":"<h2 id=\"end-of-script\">End of script<\/h2>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":["%md"," "],"enabled":true,"result":{"startTime":0,"interpreter":"md.low","endTime":1736289605718,"results":[{"message":"The paragraph run was cancelled when running the notebook as a previous paragraph encountered an error.","type":"TEXT"},{"message":"OLDS-6d21a7ae4b661a697dc1d437c7681eaf","type":"TEXT"}],"taskStatus":"CANCELLED","forms":"null","status":"ERROR"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]