[{"layout":null,"template":null,"templateConfig":null,"name":"OML4SQL Feature Extraction NMF","description":null,"readOnly":false,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","## OML4SQL Feature Extraction: Non-negative Matrix Factorization (NMF)","","In this notebook, we demonstrate how to perform dimensionality reduction using the in-database non-negative matrix factorization algorithm.","","We use the customer insurance lifetime value data set, which contains customer financial information, lifetime value, and whether or not the customer bought insurance.","","We show how to convert a table with many columns to a reduced feature set. NMF produces non-negative coefficients.","","The dataset `CUSTOMER_INSURANCE_LTV` is generated by the `\"OML Run-me-first\"` notebook, which `MUST` be run before this notebook.","","---","","##### `IMPORTANT`: The `\"OML Run-me-first\"` notebook is available under the menu Templates -> Examples and is a pre-requisite to the current notebook.","","---","","Copyright (c) 2026 Oracle Corporation ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a>"],"enabled":true,"result":{"startTime":1737858902716,"interpreter":"md.low","endTime":1737858903262,"results":[{"message":"<h2 id=\"oml4sql-feature-extraction-non-negative-matrix-factorization-nmf\">OML4SQL Feature Extraction: Non-negative Matrix Factorization (NMF)<\/h2>\n<p>In this notebook, we demonstrate how to perform dimensionality reduction using the in-database non-negative matrix factorization algorithm.<\/p>\n<p>We use the customer insurance lifetime value data set, which contains customer financial information, lifetime value, and whether or not the customer bought insurance.<\/p>\n<p>We show how to convert a table with many columns to a reduced feature set. NMF produces non-negative coefficients.<\/p>\n<p>The dataset <code>CUSTOMER_INSURANCE_LTV<\/code> is generated by the <code>&quot;OML Run-me-first&quot;<\/code> notebook, which <code>MUST<\/code> be run before this notebook.<\/p>\n<hr />\n<h5 id=\"important-the-oml-run-me-first-notebook-is-available-under-the-menu-templates---examples-and-is-a-pre-requisite-to-the-current-notebook\"><code>IMPORTANT<\/code>: The <code>&quot;OML Run-me-first&quot;<\/code> notebook is available under the menu Templates -&gt; Examples and is a pre-requisite to the current notebook.<\/h5>\n<hr />\n<p>Copyright (c) 2026 Oracle Corporation<\/p>\n<h6 id=\"the-universal-permissive-license-upl-version-10\"><a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a><\/h6>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information ...","message":["%md","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADW Documentation<\/a>  ","* <a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle Github<\/a>  ","* <a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML web page<\/a>  ","* <a href=\"https://www.oracle.com/goto/ml-feature-extraction\" target=\"_blank\">OML Feature Extraction<\/a>  ","* <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmcon/non-negative-matrix-factorization.html\" target=\"_blank\">OML4SQL NMF Documentation<\/a>  "],"enabled":true,"result":{"startTime":1737858903687,"interpreter":"md.low","endTime":1737858904117,"results":[{"message":"<ul>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADW Documentation<\/a><\/li>\n<li><a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle Github<\/a><\/li>\n<li><a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML web page<\/a><\/li>\n<li><a href=\"https://www.oracle.com/goto/ml-feature-extraction\" target=\"_blank\">OML Feature Extraction<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmcon/non-negative-matrix-factorization.html\" target=\"_blank\">OML4SQL NMF Documentation<\/a><\/li>\n<\/ul>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Display CUSTOMER_INSURANCE_LTV data","message":["%sql","","SELECT * ","FROM CUSTOMER_INSURANCE_LTV","FETCH FIRST 10 ROWS ONLY"],"enabled":true,"result":{"startTime":1737858904559,"interpreter":"sql.low","endTime":1737858906418,"results":[{"message":"MARITAL_STATUS\tSTATE\tCREDIT_BALANCE\tCUSTOMER_TENURE\tMORTGAGE_AMOUNT\tBANK_FUNDS\tNUM_DEPENDENTS\tHAS_CHILDREN\tINCOME\tCUSTOMER_ID\tGENDER\tPROFESSION\tCREDIT_CARD_LIMITS\tREGION\tHOME_OWNERSHIP\tNUM_ONLINE_TRANS\tBUY_INSURANCE\tMONTHLY_CHECKS\tNUM_TRANS_KIOSK\tAGE\tMONEY_MONTLY_OVERDRAWN\tLTV\tTOTAL_AUTOM_PAYMENTS\tNUM_TRANS_TELLER\tCHECKING_BALANCE\tNUM_TRANS_ATM\tLTV_BIN\tFIRST_NAME\tNUM_MORTGAGES\tCAR_OWNERSHIP\tLAST_NAME\nSINGLE\tCA                        \t0\t3\t0\t0\t3\t0\t65871\tCU15154                   \tM                         \tNurse\t1000\tWest\t0\t0\tNo\t0\t1\t24\t53.06\t14367.75\t0\t0\t25\t0\tMEDIUM\tGAYLE\t0\t0\tDURANT\nSINGLE\tNY                        \t0\t4\t0\t290\t4\t0\t68747\tCU15155                   \tM                         \tProgrammer/Developer\t700\tNorthEast\t0\t0\tYes\t1\t1\t35\t53.84\t14686.75\t287\t2\t25\t4\tMEDIUM\tQUINTON\t0\t1\tMASSEY\nMARRIED\tMI                        \t0\t3\t1000\t550\t3\t0\t68684\tCU15157                   \tM                         \tProgrammer/Developer\t1000\tMidwest\t1\t1000\tYes\t14\t1\t26\t53.48\t25271\t132\t2\t25\t4\tHIGH\tANIBAL\t1\t1\tJIMENEZ\nMARRIED\tUT                        \t0\t5\t1200\t1000\t5\t0\t59354\tCU15286                   \tF                         \tFireman\t2500\tSouthwest\t1\t1200\tNo\t4\t5\t24\t53.08\t19738.5\t628\t3\t619\t1\tMEDIUM\tJUNITA\t1\t1\tROBERTSON\nMARRIED\tUT                        \t0\t4\t1800\t0\t3\t0\t84801\tCU15287                   \tF                         \tPROF-26\t2500\tSouthwest\t1\t1800\tNo\t0\t5\t47\t53.06\t31900.25\t0\t0\t25\t0\tVERY HIGH\tCHASITY\t1\t1\tELLIS\nMARRIED\tUT                        \t0\t1\t1400\t0\t1\t0\t73987\tCU15289                   \tM                         \tProfessor\t2500\tSouthwest\t1\t1400\tNo\t0\t5\t46\t53.06\t31596.75\t0\t0\t25\t0\tVERY HIGH\tFRANKLIN\t1\t1\tKNOX\nSINGLE\tUT                        \t0\t3\t578\t0\t3\t0\t51452\tCU15290                   \tM                         \tSales Representative\t2500\tSouthwest\t1\t578\tNo\t0\t5\t33\t53.06\t21663\t0\t0\t25\t0\tMEDIUM\tLINCOLN\t1\t1\tMATTSON\nSINGLE\tUT                        \t0\t3\t0\t0\t3\t0\t63181\tCU15291                   \tM                         \tConstruction Laborer\t2500\tSouthwest\t0\t0\tNo\t1\t5\t49\t53.07\t16195.25\t0\t0\t25\t1\tMEDIUM\tSTEPHEN\t0\t0\tCARROLL\nSINGLE\tUT                        \t0\t5\t117\t0\t5\t0\t66654\tCU15292                   \tF                         \tPROF-3\t2500\tSouthwest\t1\t117\tNo\t0\t5\t21\t53.06\t21263.5\t0\t0\t25\t0\tMEDIUM\tCEOLA\t1\t1\tHARRISON\nSINGLE\tUT                        \t0\t3\t0\t250\t3\t0\t61716\tCU15294                   \tM                         \tProgrammer/Developer\t1500\tSouthwest\t0\t0\tNo\t3\t5\t26\t53.04\t13529\t0\t2\t25\t2\tLOW\tLLOYD\t0\t0\tHOLLEY\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Define a view with a subset of the numerical and categorical columns","message":["%script","","CREATE OR REPLACE VIEW CUST_V AS","SELECT CUSTOMER_ID, CREDIT_BALANCE, CUSTOMER_TENURE, MORTGAGE_AMOUNT, MARITAL_STATUS, GENDER, REGION","FROM CUSTOMER_INSURANCE_LTV"],"enabled":true,"result":{"startTime":1737858906852,"interpreter":"script.low","endTime":1737858907554,"results":[{"message":"\nView CUST_V created.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"html\":{\"height\":800,\"lastColumns\":[]}}]","hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Examples of possible setting overrides for NMF ","","If the user does not override the default settings, then relevant settings are determined by the algorithm.","","A complete list of settings can be found in the Documentation link:","","* Algorithm Settings: <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmapi/DBMS_DATA_MINING.html#GUID-E5CBCC4F-819A-4BD8-9C2B-BC4A9EE870AD\" target=\"_blank\">Non-Negative Matrix Factorization<\/a>","","* Shared Settings: <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmapi/DBMS_DATA_MINING.html#GUID-24047A09-0542-4870-91D8-329F28B0ED75\" target=\"_blank\">All algorithms<\/a>","","* Specify the Convergence tolerance for NMF algorithm","  The value required is between 0 and 0.5 (excluding 0), and the default is 0.05",">    v_setlst('NMFS_CONV_TOLERANCE') := '0.05';","   ","* Specify whether negative numbers should be allowed in scoring results. ","   When set to NMFS_NONNEG_SCORING_ENABLE, negative feature values will be replaced with zeros. When set to NMFS_NONNEG_SCORING_DISABLE, negative feature values will be allowed.","   The default is NMFS_NONNEG_SCORING_ENABLE",">    v_setlst('NMFS_NONNEGATIVE_SCORING') := 'NMFS_NONNEG_SCORING_ENABLE';","    ","* Specify the number of iterations for NMF algorithm","   The value required is between 1 and 500 (including the edges), and the default is 50",">    v_setlst('NMFS_NUM_ITERATIONS') := '50';","    ","* Specify the Random seed for the NMF algorithm.","   The default value is \u20131. ",">    v_setlst('NMFS_RANDOM_SEED') := '-1';","    ","--- ","","#### Other interesting overrides for Data Preparation for NMF","","Oracle Machine Learning supports fully Automatic Data Preparation (ADP), user-directed general data preparation, and user-specified embedded data preparation. The PREP_* settings enable the user to request fully automated or user-directed general data preparation. By default, fully Automatic Data Preparation (ON) is enabled. ","","A complete list of settings can be found in the Documentation link:","","* Automatic Data Preparation: <a href=\"https://docs.oracle.com/en/database/oracle/oracle-database/23/arpls/DBMS_DATA_MINING.html#GUID-5043274C-C753-47DE-9E60-D8528ADAC78D\" target=\"_blank\">Automatic Data Preparation<\/a>","","* This setting is used to specify Automatic Data Preparation.","   The value required is either ON or OFF, and the default is ON. ",">    v_setlst('PREP_AUTO') := 'ON';","    ","The model uses heuristics to transform the build data according to the requirements of the algorithm. ","","#### User defined transformations","","Instead of fully ADP, the user can request that the data be shifted and/or scaled with the PREP_SCALE* and PREP_SHIFT* settings. The transformation instructions are stored with the model and reused whenever the model is applied. The model settings can be viewed in USER_MINING_MODEL_SETTINGS. ","","* This setting enables scaling data preparation for two-dimensional numeric columns. PREP_AUTO must be OFF for this setting to take effect. The following are the possible values:","   PREP_SCALE_STDDEV: A request to divide the column values by the standard deviation of the column and is often provided together with PREP_SHIFT_MEAN to yield z-score normalization.","   PREP_SCALE_RANGE: A request to divide the column values by the range of values and is often provided together with PREP_SHIFT_MIN to yield a range of [0,1].",">    v_setlst('PREP_SCALE_2DNUM') := 'PREP_SCALE_STDDEV';","","* This setting enables centering data preparation for two-dimensional numeric columns. PREP_AUTO must be OFF for this setting to take effect. The following are the possible values:","   PREP_SHIFT_MEAN: Results in subtracting the average of the column from each value.","   PREP_SHIFT_MIN: Results in subtracting the minimum of the column from each value.",">    v_setlst('PREP_SHIFT_2DNUM') := 'PREP_SHIFT_MEAN';","","* This setting enables scaling data preparation for nested numeric columns. PREP_AUTO must be OFF for this setting to take effect. If specified, then the valid value for this setting is PREP_SCALE_MAXABS, which yields data in the range of [-1,1].",">    v_setlst('PREP_SCALE_NNUM') := 'PREP_SCALE_MAXABS';","","---"],"enabled":true,"result":{"startTime":1737858907997,"interpreter":"md.low","endTime":1737858908436,"results":[{"message":"<h3 id=\"examples-of-possible-setting-overrides-for-nmf\">Examples of possible setting overrides for NMF<\/h3>\n<p>If the user does not override the default settings, then relevant settings are determined by the algorithm.<\/p>\n<p>A complete list of settings can be found in the Documentation link:<\/p>\n<ul>\n<li>\n<p>Algorithm Settings: <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmapi/DBMS_DATA_MINING.html#GUID-E5CBCC4F-819A-4BD8-9C2B-BC4A9EE870AD\" target=\"_blank\">Non-Negative Matrix Factorization<\/a><\/p>\n<\/li>\n<li>\n<p>Shared Settings: <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmapi/DBMS_DATA_MINING.html#GUID-24047A09-0542-4870-91D8-329F28B0ED75\" target=\"_blank\">All algorithms<\/a><\/p>\n<\/li>\n<li>\n<p>Specify the Convergence tolerance for NMF algorithm\nThe value required is between 0 and 0.5 (excluding 0), and the default is 0.05<\/p>\n<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('NMFS_CONV_TOLERANCE') := '0.05';<\/p>\n<\/blockquote>\n<ul>\n<li>Specify whether negative numbers should be allowed in scoring results.\nWhen set to NMFS_NONNEG_SCORING_ENABLE, negative feature values will be replaced with zeros. When set to NMFS_NONNEG_SCORING_DISABLE, negative feature values will be allowed.\nThe default is NMFS_NONNEG_SCORING_ENABLE<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('NMFS_NONNEGATIVE_SCORING') := 'NMFS_NONNEG_SCORING_ENABLE';<\/p>\n<\/blockquote>\n<ul>\n<li>Specify the number of iterations for NMF algorithm\nThe value required is between 1 and 500 (including the edges), and the default is 50<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('NMFS_NUM_ITERATIONS') := '50';<\/p>\n<\/blockquote>\n<ul>\n<li>Specify the Random seed for the NMF algorithm.\nThe default value is \u20131.<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('NMFS_RANDOM_SEED') := '-1';<\/p>\n<\/blockquote>\n<hr />\n<h4 id=\"other-interesting-overrides-for-data-preparation-for-nmf\">Other interesting overrides for Data Preparation for NMF<\/h4>\n<p>Oracle Machine Learning supports fully Automatic Data Preparation (ADP), user-directed general data preparation, and user-specified embedded data preparation. The PREP_* settings enable the user to request fully automated or user-directed general data preparation. By default, fully Automatic Data Preparation (ON) is enabled.<\/p>\n<p>A complete list of settings can be found in the Documentation link:<\/p>\n<ul>\n<li>\n<p>Automatic Data Preparation: <a href=\"https://docs.oracle.com/en/database/oracle/oracle-database/23/arpls/DBMS_DATA_MINING.html#GUID-5043274C-C753-47DE-9E60-D8528ADAC78D\" target=\"_blank\">Automatic Data Preparation<\/a><\/p>\n<\/li>\n<li>\n<p>This setting is used to specify Automatic Data Preparation.\nThe value required is either ON or OFF, and the default is ON.<\/p>\n<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('PREP_AUTO') := 'ON';<\/p>\n<\/blockquote>\n<p>The model uses heuristics to transform the build data according to the requirements of the algorithm.<\/p>\n<h4 id=\"user-defined-transformations\">User defined transformations<\/h4>\n<p>Instead of fully ADP, the user can request that the data be shifted and/or scaled with the PREP_SCALE* and PREP_SHIFT* settings. The transformation instructions are stored with the model and reused whenever the model is applied. The model settings can be viewed in USER_MINING_MODEL_SETTINGS.<\/p>\n<ul>\n<li>This setting enables scaling data preparation for two-dimensional numeric columns. PREP_AUTO must be OFF for this setting to take effect. The following are the possible values:\nPREP_SCALE_STDDEV: A request to divide the column values by the standard deviation of the column and is often provided together with PREP_SHIFT_MEAN to yield z-score normalization.\nPREP_SCALE_RANGE: A request to divide the column values by the range of values and is often provided together with PREP_SHIFT_MIN to yield a range of [0,1].<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('PREP_SCALE_2DNUM') := 'PREP_SCALE_STDDEV';<\/p>\n<\/blockquote>\n<ul>\n<li>This setting enables centering data preparation for two-dimensional numeric columns. PREP_AUTO must be OFF for this setting to take effect. The following are the possible values:\nPREP_SHIFT_MEAN: Results in subtracting the average of the column from each value.\nPREP_SHIFT_MIN: Results in subtracting the minimum of the column from each value.<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('PREP_SHIFT_2DNUM') := 'PREP_SHIFT_MEAN';<\/p>\n<\/blockquote>\n<ul>\n<li>This setting enables scaling data preparation for nested numeric columns. PREP_AUTO must be OFF for this setting to take effect. If specified, then the valid value for this setting is PREP_SCALE_MAXABS, which yields data in the range of [-1,1].<\/li>\n<\/ul>\n<blockquote>\n<p>v_setlst('PREP_SCALE_NNUM') := 'PREP_SCALE_MAXABS';<\/p>\n<\/blockquote>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create NMF model","message":["%script","","BEGIN ","    DBMS_DATA_MINING.DROP_MODEL('NMF_LTV_MDL');","    EXCEPTION WHEN OTHERS THEN NULL; ","END;","/","","DECLARE","    V_SETLST DBMS_DATA_MINING.SETTING_LIST;","BEGIN","    V_SETLST('ALGO_NAME')  := 'ALGO_NONNEGATIVE_MATRIX_FACTOR';","    V_SETLST('PREP_AUTO')  := 'ON';","    V_SETLST('FEAT_NUM_FEATURES')  := '5';","    ","    DBMS_DATA_MINING.CREATE_MODEL2(","        MODEL_NAME          => 'NMF_LTV_MDL',","        MINING_FUNCTION     => 'FEATURE_EXTRACTION',","        CASE_ID_COLUMN_NAME => 'CUSTOMER_ID',","        DATA_QUERY          => 'SELECT * FROM CUST_V',","        SET_LIST            => V_SETLST);","END;"],"enabled":true,"result":{"startTime":1737858908865,"interpreter":"script.low","endTime":1737858910927,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"List the NMF model views available","message":["%sql","","SELECT VIEW_NAME, VIEW_TYPE FROM USER_MINING_MODEL_VIEWS","  WHERE MODEL_NAME='NMF_LTV_MDL'","  ORDER BY VIEW_NAME"],"enabled":true,"result":{"startTime":1737858911369,"interpreter":"sql.low","endTime":1737858911841,"results":[{"message":"VIEW_NAME\tVIEW_TYPE\nDM$VENMF_LTV_MDL\tNon-Negative Matrix Factorization H Matrix\nDM$VGNMF_LTV_MDL\tGlobal Name-Value Pairs\nDM$VINMF_LTV_MDL\tNon-Negative Matrix Factorization Inverse H Matrix\nDM$VNNMF_LTV_MDL\tNormalization and Missing Value Handling\nDM$VSNMF_LTV_MDL\tComputed Settings\nDM$VWNMF_LTV_MDL\tModel Build Alerts\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Check coefficients of original columns associated to each NMF feature","message":["%sql","","SELECT FEATURE_ID,","       ATTRIBUTE_NAME,","       ATTRIBUTE_VALUE,","       COEFFICIENT","FROM DM$VENMF_LTV_MDL","ORDER BY FEATURE_ID,ATTRIBUTE_NAME,ATTRIBUTE_VALUE","FETCH FIRST 30 ROWS ONLY"],"enabled":true,"result":{"startTime":1737858912282,"interpreter":"sql.low","endTime":1737858912760,"results":[{"message":"FEATURE_ID\tATTRIBUTE_NAME\tATTRIBUTE_VALUE\tCOEFFICIENT\n1\tCREDIT_BALANCE\t\t0.001340184597950889\n1\tCUSTOMER_TENURE\t\t0.08491322814520694\n1\tGENDER\tF                         \t0.09780370828038705\n1\tGENDER\tM                         \t0.3298818924269928\n1\tMARITAL_STATUS\tDIVORCED\t0.044296713537437596\n1\tMARITAL_STATUS\tMARRIED\t0.0784670024345143\n1\tMARITAL_STATUS\tOTHER\t0.004534870161403671\n1\tMARITAL_STATUS\tSINGLE\t0.03556709261641716\n1\tMARITAL_STATUS\tWIDOWED\t0.007785204835084698\n1\tMORTGAGE_AMOUNT\t\t0.0013599283262101575\n1\tREGION\tMidwest\t0.08304934840432189\n1\tREGION\tNorthEast\t0.036824028128878035\n1\tREGION\tSouth\t0.023342685762574207\n1\tREGION\tSouthwest\t0.028066134954678388\n1\tREGION\tWest\t0.00845475426219793\n2\tCREDIT_BALANCE\t\t4.934352950880333E-4\n2\tCUSTOMER_TENURE\t\t0.024174121965280678\n2\tGENDER\tF                         \t0.14096637840904322\n2\tGENDER\tM                         \t0.206074157025542\n2\tMARITAL_STATUS\tDIVORCED\t0.2223087117597371\n2\tMARITAL_STATUS\tMARRIED\t0.1391199365865613\n2\tMARITAL_STATUS\tOTHER\t0.001527958893974671\n2\tMARITAL_STATUS\tSINGLE\t0.08021795904162299\n2\tMARITAL_STATUS\tWIDOWED\t0.004037871485728927\n2\tMORTGAGE_AMOUNT\t\t0.01131762053894168\n2\tREGION\tMidwest\t0.07999242704296103\n2\tREGION\tNorthEast\t0.12416388255313135\n2\tREGION\tSouth\t0.021676219489230035\n2\tREGION\tSouthwest\t0.014610794420396827\n2\tREGION\tWest\t0.13188443902187472\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Check first four NMF features for each customer","message":["%sql ","","SELECT CUSTOMER_ID, ","       ROUND(FEATURE_VALUE(NMF_LTV_MDL, 1 USING *),4) NMF_PROJ1,","       ROUND(FEATURE_VALUE(NMF_LTV_MDL, 2 USING *),4) NMF_PROJ2,","       ROUND(FEATURE_VALUE(NMF_LTV_MDL, 3 USING *),4) NMF_PROJ3,","       ROUND(FEATURE_VALUE(NMF_LTV_MDL, 4 USING *),4) NMF_PROJ4","FROM CUST_V","ORDER BY 1, 2","FETCH FIRST 20 ROWS ONLY"],"enabled":true,"result":{"startTime":1737858913217,"interpreter":"sql.low","endTime":1737858913695,"results":[{"message":"CUSTOMER_ID\tNMF_PROJ1\tNMF_PROJ2\tNMF_PROJ3\tNMF_PROJ4\nCU1                       \t1.5535\t1.8228\t0\t8.4612\nCU10                      \t0\t5.6516\t0\t6.4315\nCU1000                    \t1.3552\t0\t5.5198\t0\nCU10000                   \t1.9768\t0\t0\t0\nCU10001                   \t0.1962\t1.9594\t7.668\t0\nCU10003                   \t0\t7.2598\t0\t8.9182\nCU10004                   \t1.555\t0\t0\t5.1539\nCU10005                   \t1.6082\t0\t0\t2.6702\nCU10006                   \t1.3\t1.7619\t2.9731\t0\nCU10007                   \t0.1598\t0\t3.8602\t0\nCU10008                   \t0.1614\t0\t3.8596\t0\nCU1001                    \t0.5763\t0\t3.6229\t0\nCU10010                   \t1.5532\t0\t0\t5.1554\nCU10011                   \t0\t5.8542\t0\t8.4789\nCU10012                   \t0.7239\t0.0094\t3.7144\t0.0192\nCU10013                   \t0\t4.7695\t0\t5.4605\nCU10014                   \t1.5529\t0\t0\t5.1556\nCU10015                   \t1.555\t0\t0\t5.1539\nCU10016                   \t0\t3.0397\t0\t1.3067\nCU10017                   \t1.5532\t0\t0\t5.1554\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"NMF Feature vector 1","message":["%sql","","SELECT ATTRIBUTE_NAME, ","       ATTRIBUTE_VALUE, ","       ROUND(COEFFICIENT,4) COEFF","FROM DM$VENMF_LTV_MDL","WHERE FEATURE_ID = 1","ORDER BY COEFFICIENT DESC","FETCH FIRST 20 ROWS ONLY"],"enabled":true,"result":{"startTime":1737858914124,"interpreter":"sql.low","endTime":1737858914574,"results":[{"message":"ATTRIBUTE_NAME\tATTRIBUTE_VALUE\tCOEFF\nGENDER\tM                         \t0.3299\nGENDER\tF                         \t0.0978\nCUSTOMER_TENURE\t\t0.0849\nREGION\tMidwest\t0.083\nMARITAL_STATUS\tMARRIED\t0.0785\nMARITAL_STATUS\tDIVORCED\t0.0443\nREGION\tNorthEast\t0.0368\nMARITAL_STATUS\tSINGLE\t0.0356\nREGION\tSouthwest\t0.0281\nREGION\tSouth\t0.0233\nREGION\tWest\t0.0085\nMARITAL_STATUS\tWIDOWED\t0.0078\nMARITAL_STATUS\tOTHER\t0.0045\nMORTGAGE_AMOUNT\t\t0.0014\nCREDIT_BALANCE\t\t0.0013\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":4,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"NMF Feature vector 2","message":["%sql","","SELECT ATTRIBUTE_NAME, ","       ATTRIBUTE_VALUE, ","       ROUND(COEFFICIENT,4) COEFF","FROM DM$VENMF_LTV_MDL","WHERE FEATURE_ID = 2","ORDER BY COEFFICIENT DESC","FETCH FIRST 20 ROWS ONLY"],"enabled":true,"result":{"startTime":1737858915002,"interpreter":"sql.low","endTime":1737858915448,"results":[{"message":"ATTRIBUTE_NAME\tATTRIBUTE_VALUE\tCOEFF\nMARITAL_STATUS\tDIVORCED\t0.2223\nGENDER\tM                         \t0.2061\nGENDER\tF                         \t0.141\nMARITAL_STATUS\tMARRIED\t0.1391\nREGION\tWest\t0.1319\nREGION\tNorthEast\t0.1242\nMARITAL_STATUS\tSINGLE\t0.0802\nREGION\tMidwest\t0.08\nCUSTOMER_TENURE\t\t0.0242\nREGION\tSouth\t0.0217\nREGION\tSouthwest\t0.0146\nMORTGAGE_AMOUNT\t\t0.0113\nMARITAL_STATUS\tWIDOWED\t0.004\nMARITAL_STATUS\tOTHER\t0.0015\nCREDIT_BALANCE\t\t0.0005\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":4,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"NMF Feature vector 3","message":["%sql","","SELECT ATTRIBUTE_NAME, ","       ATTRIBUTE_VALUE, ","       ROUND(COEFFICIENT,4) COEFF","FROM DM$VENMF_LTV_MDL","WHERE FEATURE_ID = 3","ORDER BY COEFFICIENT DESC","FETCH FIRST 20 ROWS ONLY"],"enabled":true,"result":{"startTime":1737858915872,"interpreter":"sql.low","endTime":1737858916343,"results":[{"message":"ATTRIBUTE_NAME\tATTRIBUTE_VALUE\tCOEFF\nGENDER\tM                         \t0.316\nCUSTOMER_TENURE\t\t0.1972\nMARITAL_STATUS\tSINGLE\t0.1713\nMARITAL_STATUS\tMARRIED\t0.1478\nREGION\tNorthEast\t0.1198\nREGION\tMidwest\t0.0538\nGENDER\tF                         \t0.052\nMARITAL_STATUS\tDIVORCED\t0.0519\nREGION\tSouth\t0.0466\nREGION\tWest\t0.0368\nREGION\tSouthwest\t0.0162\nMARITAL_STATUS\tWIDOWED\t0.0118\nMORTGAGE_AMOUNT\t\t0.0082\nMARITAL_STATUS\tOTHER\t0.0009\nCREDIT_BALANCE\t\t0.0008\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":4,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Create an NMF Feature Extraction Model using Settings Table","","The settings table is an alternative way to specify algorithm settings to build the model. We first drop the settings table, create it, and then populate it with settings before building the model.","","---"],"enabled":true,"result":{"startTime":1737858916775,"interpreter":"md.low","endTime":1737858917188,"results":[{"message":"<h2 id=\"create-an-nmf-feature-extraction-model-using-settings-table\">Create an NMF Feature Extraction Model using Settings Table<\/h2>\n<p>The settings table is an alternative way to specify algorithm settings to build the model. We first drop the settings table, create it, and then populate it with settings before building the model.<\/p>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Drop old setting table","message":["%script","","BEGIN EXECUTE IMMEDIATE 'DROP TABLE nmf_ltv_settings';","EXCEPTION WHEN OTHERS THEN NULL; END;"],"enabled":true,"result":{"startTime":1737858917637,"interpreter":"script.low","endTime":1737858918098,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Create setting table","message":["%sql","","CREATE TABLE NMF_LTV_SETTINGS (","   SETTING_NAME  VARCHAR2(30),","   SETTING_VALUE VARCHAR2(4000));"],"enabled":true,"result":{"startTime":1737858918544,"interpreter":"sql.low","endTime":1737858919083,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Specify settings","message":["%script","","BEGIN","  INSERT INTO NMF_LTV_SETTINGS (SETTING_NAME, SETTING_VALUE) VALUES","  (DBMS_DATA_MINING.PREP_AUTO,DBMS_DATA_MINING.PREP_AUTO_ON);","  INSERT INTO NMF_LTV_SETTINGS (SETTING_NAME, SETTING_VALUE) VALUES","  (DBMS_DATA_MINING.FEAT_NUM_FEATURES, 5);","","END;"],"enabled":true,"result":{"startTime":1737858919536,"interpreter":"script.low","endTime":1737858920002,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create NMF model","message":["%script","","BEGIN DBMS_DATA_MINING.DROP_MODEL('NMF_LTV_MDL');","EXCEPTION WHEN OTHERS THEN NULL; END;","/","","BEGIN","  DBMS_DATA_MINING.CREATE_MODEL(","    MODEL_NAME          => 'NMF_LTV_MDL',","    MINING_FUNCTION     => DBMS_DATA_MINING.FEATURE_EXTRACTION,","    DATA_TABLE_NAME     => 'CUST_V',","    CASE_ID_COLUMN_NAME => 'CUSTOMER_ID',","    SETTINGS_TABLE_NAME => 'NMF_LTV_SETTINGS');","END;"],"enabled":true,"result":{"startTime":1737858920444,"interpreter":"script.low","endTime":1737858921907,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# End of Script"],"enabled":true,"result":{"startTime":1737858922340,"interpreter":"md.low","endTime":1737858922760,"results":[{"message":"<h1 id=\"end-of-script\">End of Script<\/h1>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":[],"enabled":true,"result":{"startTime":1737858923183,"interpreter":"md.low","endTime":1737858923611,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]