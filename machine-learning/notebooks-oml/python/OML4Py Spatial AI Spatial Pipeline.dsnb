[{"layout":null,"template":null,"templateConfig":null,"name":"OML4Py Spatial AI Spatial Pipeline","description":null,"readOnly":false,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# Spatial Pipeline - Spatial AI in Oracle Machine Learning for Python (OML4Py)","","Oracle Machine Learning for Python (OML4Py) makes the Python environment ready for the enterprise. OML4Py integrates Python with Oracle Autonomous Database, enabling the use of Python for machine learning and visualization from database tables and views. Spatial AI is a feature of OML4Py providing algorithms and APIs to analyze, make predictions, and detect patterns from geospatial data. ","","In this notebook, you experiment with the Spatial AI Pipeline classes, which extend sklearn Pipeline, ColumnTransformer and FeatureUnion to handle spatial transformers and estimators. ","To see the benefits, you will perform the same operations without and then with pipelines.","","The key concepts for pipelines are:","- Transformer which provides fit() and transform() methods to transform data as needed for model input. ","- Estimator which provides fit( ) and predict( ) methods to infer properties based on training. ","- ColumnTransformer and FeatureUnion which combine transformers into a new transformer combining their results.","- Pipeline which combines transformers and, if needed, a final estimator.","","The pipeline operations in Spatial AI are `SpatialColumnTransformer` and `SpatialFeatureUnion`, and `SpatialPipeline`.","","","**Copyright (c) 2026 Oracle Corporation**","[The Universal Permissive License (UPL), Version 1.0](https://oss.oracle.com/licenses/upl/)"," "],"enabled":true,"result":{"startTime":1737665362766,"interpreter":"md.low","endTime":1737665363326,"results":[{"message":"<h1 id=\"spatial-pipeline---spatial-ai-in-oracle-machine-learning-for-python-oml4py\">Spatial Pipeline - Spatial AI in Oracle Machine Learning for Python (OML4Py)<\/h1>\n<p>Oracle Machine Learning for Python (OML4Py) makes the Python environment ready for the enterprise. OML4Py integrates Python with Oracle Autonomous Database, enabling the use of Python for machine learning and visualization from database tables and views. Spatial AI is a feature of OML4Py providing algorithms and APIs to analyze, make predictions, and detect patterns from geospatial data.<\/p>\n<p>In this notebook, you experiment with the Spatial AI Pipeline classes, which extend sklearn Pipeline, ColumnTransformer and FeatureUnion to handle spatial transformers and estimators.\nTo see the benefits, you will perform the same operations without and then with pipelines.<\/p>\n<p>The key concepts for pipelines are:<\/p>\n<ul>\n<li>Transformer which provides fit() and transform() methods to transform data as needed for model input.<\/li>\n<li>Estimator which provides fit( ) and predict( ) methods to infer properties based on training.<\/li>\n<li>ColumnTransformer and FeatureUnion which combine transformers into a new transformer combining their results.<\/li>\n<li>Pipeline which combines transformers and, if needed, a final estimator.<\/li>\n<\/ul>\n<p>The pipeline operations in Spatial AI are <code>SpatialColumnTransformer<\/code> and <code>SpatialFeatureUnion<\/code>, and <code>SpatialPipeline<\/code>.<\/p>\n<p><strong>Copyright (c) 2026 Oracle Corporation<\/strong>\n<a href=\"https://oss.oracle.com/licenses/upl/\">The Universal Permissive License (UPL), Version 1.0<\/a><\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Before you begin","message":["%md","","Run the notebook **OML4Py Spatial AI Run-me-first** which loads data used in all sample notebooks."],"enabled":true,"result":{"startTime":1737665363825,"interpreter":"md.low","endTime":1737665364296,"results":[{"message":"<p>Run the notebook <strong>OML4Py Spatial AI Run-me-first<\/strong> which loads data used in all sample notebooks.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Import required libraries","message":["%python","","import os","import geopandas","from sklearn.preprocessing import RobustScaler","from sklearn.impute import SimpleImputer","from libpysal import weights","import matplotlib.pyplot as plt","import pandas as pd","import numpy as np","","import random","random_state = 456","random.seed(random_state)","","from oraclesai import SpatialDataFrame, DBSpatialDataset","from oraclesai.pipeline import SpatialPipeline, SpatialFeatureUnion, SpatialColumnTransformer","from oraclesai.preprocessing import SpatialLagTransformer, SpatialImputer","from oraclesai.weights import SpatialWeights, KNNWeightsDefinition, DistanceBandWeightsDefinition, QueenWeightsDefinition, RookWeightsDefinition","from oraclesai import enable_geodataframes","from oraclesai.regression import GWRRegressor","enable_geodataframes(z)"," "],"enabled":true,"result":{"startTime":1737665364798,"interpreter":"python.low","endTime":1737665368489,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"bar\":{\"series\":{\"availableSeriesElements\":[{\"id\":\"GEOID\",\"lineType\":\"straight\",\"borderColor\":\"rgb(25, 95, 116)\",\"borderWidth\":0,\"color\":\"rgb(25, 95, 116)\",\"pattern\":\"auto\",\"markerColor\":\"rgb(25, 95, 116)\",\"markerDisplayed\":\"auto\",\"markerShape\":\"auto\",\"markerSize\":0}]},\"lastColumns\":[\"GEOID\",\"MEAN_AGE\",\"MEAN_EDUCATION_LEVEL\",\"HOUSE_VALUE\",\"MEDIAN_INCOME\",\"geometry\"],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"table","title":"Create SpatialDataFrame for LA_BLOCK_GROUPS table","message":["%python","","block_groups_sdf = SpatialDataFrame.create(DBSpatialDataset(table='la_block_groups'))","block_groups_sdf = block_groups_sdf[['GEOID', 'MEAN_AGE', 'MEAN_EDUCATION_LEVEL', 'HOUSE_VALUE', 'MEDIAN_INCOME', 'geometry']]","# Convert to projected coordinated as required for spatial weights","block_groups_sdf = block_groups_sdf.to_crs('epsg:3857')","z.show(block_groups_sdf.head())"],"enabled":true,"result":{"startTime":1737665368964,"interpreter":"python.low","endTime":1737665369632,"results":[{"message":"GEOID\tMEAN_AGE\tMEAN_EDUCATION_LEVEL\tHOUSE_VALUE\tMEDIAN_INCOME\tgeometry\n060376700031\t37.306\t9.746\t627700\t75577\tPOLYGON ((-13171614.921 4002458.952, -13171006.56 4002139.446, -13171013.684 4001739.038, -13171618.149 4001743.458, -13171614.921 4002458.952))\n060376700032\t39.161\t11.504\t599300\t74609\tPOLYGON ((-13171618.149 4001743.458, -13171013.684 4001739.038, -13171015.02 4000576.34, -13171318.477 4000575.938, -13171317.364 4000963.044, -13171619.596 4000964.384, -13171618.149 4001743.458))\n060376700033\t47.854\t10.976\t609500\t55592\tPOLYGON ((-13172221.723 4001742.521, -13171917.599 4001742.655, -13171921.495 4000965.188, -13171619.596 4000964.384, -13171317.364 4000963.044, -13171318.477 4000575.938, -13171620.932 4000577.813, -13172015.56 4000578.081, -13172039.716 4000577.947, -13172233.857 4000679.478, -13172221.723 4001742.521))\n060376700034\t39.283\t10.115\t471000\t73558\tPOLYGON ((-13172222.837 4002094.032, -13171984.724 4002093.229, -13171983.722 4002423.986, -13172204.246 4002425.058, -13172206.918 4002769.356, -13171614.921 4002458.952, -13171618.149 4001743.458, -13171619.596 4000964.384, -13171921.495 4000965.188, -13171917.599 4001742.655, -13172221.723 4001742.521, -13172222.837 4002094.032))\n060376701001\t37.998\t10.716\t389900\t54738\tPOLYGON ((-13171620.932 4000577.813, -13171318.477 4000575.938, -13171015.02 4000576.34, -13170712.342 4000574.063, -13170717.463 4000012.581, -13171091.051 4000012.313, -13171186.007 3999904.092, -13171571.395 4000085.443, -13171620.932 3999984.052, -13171620.932 4000577.813))\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","##### Assemble the results of multiple spatial transformers","","Assemble the spatial lags based on mean and median for mean_age and house_value. First without using a pipeline. "],"enabled":true,"result":{"startTime":1737665370159,"interpreter":"md.low","endTime":1737665370604,"results":[{"message":"<h5 id=\"assemble-the-results-of-multiple-spatial-transformers\">Assemble the results of multiple spatial transformers<\/h5>\n<p>Assemble the spatial lags based on mean and median for mean_age and house_value. First without using a pipeline.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Define variables for transformer","message":["%python","","X = block_groups_sdf.drop(\"GEOID\").drop(\"MEDIAN_INCOME\")","spatial_weights = SpatialWeights.create(block_groups_sdf, KNNWeightsDefinition(k=20))","lag_columns = ['MEAN_AGE_LAG','MEAN_EDUCATION_LEVEL_LAG','MEAN_HOUSE_VALUE_LAG','MEDIAN_AGE_LAG','MEDIAN_EDUCATION_LEVEL_LAG','MEDIAN_HOUSE_VALUE_LAG']"," "],"enabled":true,"result":{"startTime":1737665371092,"interpreter":"python.low","endTime":1737665383214,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Assemble results of transformers","message":["%python","","mean_result = SpatialLagTransformer(strategy=\"mean\").fit_transform(X, spatial_weights=spatial_weights)","median_result = SpatialLagTransformer(strategy=\"median\").fit_transform(X, spatial_weights=spatial_weights)","","z.show(pd.DataFrame(np.concatenate((mean_result, median_result), axis=1), columns=lag_columns).head())"],"enabled":true,"result":{"startTime":1737665390840,"interpreter":"python.low","endTime":1737665402959,"results":[{"message":"MEAN_AGE_LAG\tMEAN_EDUCATION_LEVEL_LAG\tMEAN_HOUSE_VALUE_LAG\tMEDIAN_AGE_LAG\tMEDIAN_EDUCATION_LEVEL_LAG\tMEDIAN_HOUSE_VALUE_LAG\n40.66353729678744\t10.669541125981235\t562280.0\t40.36510197710949\t10.791361723145643\t582700.0\n39.63003284820595\t10.120157374848905\t532040.0\t39.13960639418132\t10.41018323071129\t519400.0\n40.78304255956752\t10.930462872647484\t634740.0\t41.22209163368304\t11.007437687509348\t617700.0\n40.68773015468646\t10.864451673511873\t603925.0\t40.36510197710949\t10.89919367262554\t611250.0\n39.53882629201207\t10.206520825997432\t563465.0\t39.22171852224933\t10.270578381544205\t550800.0\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","Next you repeat using pipeline. Instead of running transforms individually and concatenating, you may use a single SpatialFeatureUnion pipeline to perform a series of transforms and return the combined result of a single Numpy array with the results of all transforms. This is convenient when numerous transforms are involved."],"enabled":true,"result":{"startTime":1737665403498,"interpreter":"md.low","endTime":1737665403963,"results":[{"message":"<p>Next you repeat using pipeline. Instead of running transforms individually and concatenating, you may use a single SpatialFeatureUnion pipeline to perform a series of transforms and return the combined result of a single Numpy array with the results of all transforms. This is convenient when numerous transforms are involved.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Assemble spatial transformer results with SpatialFeatureUnion","message":["%python","","lag_results = SpatialFeatureUnion([(\"spatial_lag_mean\", SpatialLagTransformer(strategy=\"mean\")), \\","                                   (\"spatial_lag_median\", SpatialLagTransformer(strategy=\"median\"))]) \\","                                   .fit_transform(X, spatial_weights=spatial_weights)","","z.show(pd.DataFrame(lag_results, columns=lag_columns).head())"],"enabled":true,"result":{"startTime":1737665404448,"interpreter":"python.low","endTime":1737665405027,"results":[{"message":"MEAN_AGE_LAG\tMEAN_EDUCATION_LEVEL_LAG\tMEAN_HOUSE_VALUE_LAG\tMEDIAN_AGE_LAG\tMEDIAN_EDUCATION_LEVEL_LAG\tMEDIAN_HOUSE_VALUE_LAG\n40.66353729678744\t10.669541125981235\t562280.0\t40.36510197710949\t10.791361723145643\t582700.0\n39.63003284820595\t10.120157374848905\t532040.0\t39.13960639418132\t10.41018323071129\t519400.0\n40.78304255956752\t10.930462872647484\t634740.0\t41.22209163368304\t11.007437687509348\t617700.0\n40.68773015468646\t10.864451673511873\t603925.0\t40.36510197710949\t10.89919367262554\t611250.0\n39.53882629201207\t10.206520825997432\t563465.0\t39.22171852224933\t10.270578381544205\t550800.0\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","SpatialColumnTransformer is also provided, which has the same capability as SpatialFeatureUnion with the added ability to specify specific columns for transform. "],"enabled":true,"result":{"startTime":1737665405501,"interpreter":"md.low","endTime":1737665405958,"results":[{"message":"<p>SpatialColumnTransformer is also provided, which has the same capability as SpatialFeatureUnion with the added ability to specify specific columns for transform.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md"," ","##### Spatial regression","","Next you scale features and train a model, first without and then with a spatial pipeline. "],"enabled":true,"result":{"startTime":1737665406453,"interpreter":"md.low","endTime":1737665406907,"results":[{"message":"<h5 id=\"spatial-regression\">Spatial regression<\/h5>\n<p>Next you scale features and train a model, first without and then with a spatial pipeline.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Split data for training, testing, validation","message":["%python"," ","X_train, X_test, X_valid = block_groups_sdf.split(ratio=(0.7, 0.2, 0.1), seed=random_state)"],"enabled":true,"result":{"startTime":1737665407393,"interpreter":"python.low","endTime":1737665407949,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","Create instance of RobustScaler to fit_transform training data, and then to transform test data. Note, here we have to use .get_values() but later you will see that pipeline handles this automatically "," "],"enabled":true,"result":{"startTime":1737665408462,"interpreter":"md.low","endTime":1737665408903,"results":[{"message":"<p>Create instance of RobustScaler to fit_transform training data, and then to transform test data. Note, here we have to use .get_values() but later you will see that pipeline handles this automatically<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Scale features for model training","message":["%python","","scaler = RobustScaler().fit(X_train.drop(['GEOID', 'MEDIAN_INCOME']).get_values())","scaled_df = pd.DataFrame(scaler.transform(X_train.drop(['GEOID','MEDIAN_INCOME']).get_values()))","X_train_scaled = X_train.add_column('AGE_SCALED',scaled_df[0]) \\","                               .add_column('EDUCATION_LEVEL_SCALED',scaled_df[1]) \\","                               .add_column('HOUSE_VALUE_SCALED',scaled_df[2])","X_train_scaled = X_train_scaled[['MEDIAN_INCOME','AGE_SCALED', 'EDUCATION_LEVEL_SCALED', 'HOUSE_VALUE_SCALED','geometry' ]]","z.show(X_train_scaled.head())","",""," "],"enabled":true,"result":{"startTime":1737665409787,"interpreter":"python.low","endTime":1737665412305,"results":[{"message":"MEDIAN_INCOME\tAGE_SCALED\tEDUCATION_LEVEL_SCALED\tHOUSE_VALUE_SCALED\tgeometry\n55592\t1.344\t0.295\t0.399\tPOLYGON ((-13172221.723 4001742.521, -13171917.599 4001742.655, -13171921.495 4000965.188, -13171619.596 4000964.384, -13171317.364 4000963.044, -13171318.477 4000575.938, -13171620.932 4000577.813, -13172015.56 4000578.081, -13172039.716 4000577.947, -13172233.857 4000679.478, -13172221.723 4001742.521))\n73558\t0.227\t0.057\t0.012\tPOLYGON ((-13172222.837 4002094.032, -13171984.724 4002093.229, -13171983.722 4002423.986, -13172204.246 4002425.058, -13172206.918 4002769.356, -13171614.921 4002458.952, -13171618.149 4001743.458, -13171619.596 4000964.384, -13171921.495 4000965.188, -13171917.599 4001742.655, -13172221.723 4001742.521, -13172222.837 4002094.032))\n54738\t0.059\t0.223\t-0.214\tPOLYGON ((-13171620.932 4000577.813, -13171318.477 4000575.938, -13171015.02 4000576.34, -13170712.342 4000574.063, -13170717.463 4000012.581, -13171091.051 4000012.313, -13171186.007 3999904.092, -13171571.395 4000085.443, -13171620.932 3999984.052, -13171620.932 4000577.813))\n69464\t0.133\t0.736\t1.156\tPOLYGON ((-13177704.097 4037258.346, -13177694.635 4037594.423, -13177139.485 4037431.826, -13177114.104 4037377.806, -13177137.926 4037157.027, -13177207.389 4037107.175, -13177556.153 4036856.705, -13177575.412 4036789.117, -13177696.973 4036778.636, -13177704.097 4037258.346))\n62109\t0.401\t0.645\t1.894\tPOLYGON ((-13179541.871 4037158.371, -13179080.674 4037158.774, -13179098.151 4036469.725, -13179314.445 4036469.994, -13179544.431 4036470.262, -13179541.871 4037158.371))\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Train GWR model","message":["%python","","gwr_model = GWRRegressor(spatial_weights_definition=KNNWeightsDefinition(k=20))","gwr_model.fit(X_train_scaled.drop(['MEDIAN_INCOME']), X_train_scaled['MEDIAN_INCOME'].get_values())"],"enabled":true,"result":{"startTime":1737665412784,"interpreter":"python.low","endTime":1737665415591,"results":[{"message":"GWRRegressor(bandwidth=20, fixed=False,\n             spatial_weights_definition=<oraclesai.weights.weights_definition.KNNWeightsDefinition object at 0x7f9e3f9ff320>)\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","To test the model without using a pipeline, you need to you scale the test features using the trained scaler."," "],"enabled":true,"result":{"startTime":1737665416101,"interpreter":"md.low","endTime":1737665416565,"results":[{"message":"<p>To test the model without using a pipeline, you need to you scale the test features using the trained scaler.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Scale the test data","message":["%python","","scaled_df = pd.DataFrame(scaler.transform(X_test.drop(['GEOID', 'MEDIAN_INCOME']).get_values()))","X_test_scaled = X_test.add_column('AGE_SCALED',scaled_df[0]) \\","                             .add_column('EDUCATION_LEVEL_SCALED',scaled_df[1]) \\","                             .add_column('HOUSE_VALUE_SCALED',scaled_df[2])","X_test_scaled = X_test_scaled[['MEDIAN_INCOME','AGE_SCALED', 'EDUCATION_LEVEL_SCALED', 'HOUSE_VALUE_SCALED','geometry' ]]","z.show(X_test_scaled.head())","",""," "],"enabled":true,"result":{"startTime":1737665417041,"interpreter":"python.low","endTime":1737665429911,"results":[{"message":"MEDIAN_INCOME\tAGE_SCALED\tEDUCATION_LEVEL_SCALED\tHOUSE_VALUE_SCALED\tgeometry\n75577\t-0.031\t-0.045\t0.449\tPOLYGON ((-13171614.921 4002458.952, -13171006.56 4002139.446, -13171013.684 4001739.038, -13171618.149 4001743.458, -13171614.921 4002458.952))\n74609\t0.211\t0.441\t0.37\tPOLYGON ((-13171618.149 4001743.458, -13171013.684 4001739.038, -13171015.02 4000576.34, -13171318.477 4000575.938, -13171317.364 4000963.044, -13171619.596 4000964.384, -13171618.149 4001743.458))\n87561\t-0.16\t0.676\t2.718\tPOLYGON ((-13180132.309 4036899.704, -13180124.628 4037159.177, -13179541.871 4037158.371, -13179544.431 4036470.262, -13179857.573 4036470.665, -13180060.731 4036470.934, -13180125.296 4036463.007, -13180125.296 4036471.203, -13180132.309 4036899.704))\n89511\t1.681\t0.466\t0.731\tPOLYGON ((-13189907.83 4032604.538, -13189483.035 4033018.79, -13189130.709 4032656.252, -13189554.613 4032243.088, -13189907.83 4032604.538))\n72941\t-0.537\t-0.164\t-0.377\tPOLYGON ((-13184549.244 4069036.522, -13183886.002 4069752.482, -13183483.805 4069394.699, -13184249.349 4068714.74, -13184549.244 4069036.522))\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Review test predictions","message":["%python","","predictions = gwr_model.predict(X_test_scaled.drop(['MEDIAN_INCOME']))","predictions[0:9].flatten()"],"enabled":true,"result":{"startTime":1737665430406,"interpreter":"python.low","endTime":1737665431606,"results":[{"message":"array([ 82938.98578486,  85402.61560807,  89475.90995388,  72871.52147725,\n        61578.47287461,  70157.21005115, 126808.87268818, 126418.38687402,\n        71578.1341477 ])\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","You now repeat the training using a spatial pipeline, which automatically handles scaling the test data using the trained scaler and passing results to training."," "],"enabled":true,"result":{"startTime":1737665432116,"interpreter":"md.low","endTime":1737665432636,"results":[{"message":"<p>You now repeat the training using a spatial pipeline, which automatically handles scaling the test data using the trained scaler and passing results to training.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Train a pipeline with scaler and GWR","message":["%python","","gwr_pipe = SpatialPipeline([('scale', RobustScaler()), ('gwr_regression', gwr_model)])","gwr_pipe.fit(X_train.drop('GEOID'), \"MEDIAN_INCOME\")"," "],"enabled":true,"result":{"startTime":1737665433139,"interpreter":"python.low","endTime":1737665435051,"results":[{"message":"SpatialPipeline(steps=[('scale', RobustScaler()),\n                       ('gwr_regression',\n                        GWRRegressor(bandwidth=20, fixed=False,\n                                     spatial_weights_definition=<oraclesai.weights.weights_definition.KNNWeightsDefinition object at 0x7f9e3f9ff320>))])\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Review test predictions","message":["%python","","gwr_pipe.predict(X_test.drop(['GEOID', \"MEDIAN_INCOME\"]))[0:9].flatten()"],"enabled":true,"result":{"startTime":1737665435536,"interpreter":"python.low","endTime":1737665436927,"results":[{"message":"array([ 82938.98578486,  85402.61560807,  89475.90995388,  72871.52147725,\n        61578.47287461,  70157.21005115, 126808.87268818, 126418.38687402,\n        71578.1341477 ])\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","Observe that the prediction results are the same without and with the pipeline. The difference is the simplicity of model training using a spatial pipeline."," "],"enabled":true,"result":{"startTime":1737665437438,"interpreter":"md.low","endTime":1737665437894,"results":[{"message":"<p>Observe that the prediction results are the same without and with the pipeline. The difference is the simplicity of model training using a spatial pipeline.<\/p>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## End of Script"," "],"enabled":true,"result":{"startTime":1737665438394,"interpreter":"md.low","endTime":1737665438838,"results":[{"message":"<h2 id=\"end-of-script\">End of Script<\/h2>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":0,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]