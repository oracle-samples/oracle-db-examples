[{"layout":null,"template":null,"templateConfig":null,"name":"OML4Py Importing Wide Datasets","description":null,"readOnly":false,"type":"medium","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":["%md"," "],"enabled":true,"result":{"startTime":1736204675171,"interpreter":"md.medium","endTime":1736204675645,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# Importing Wide Datasets using OML4Py","","Oracle Database has a limit of 1,000 columns in a table or view. Machine learning projects may involve datasets, perhaps stored as CSV files, with a higher number of columns. OML4SQL in-database algorithms can handle such wide datasets by converting the columns to a special format known as \"nested columns\". This allows an efficient handling of high dimensional and sparse features, as well as accomodating more than 1000 predictor columns, when building OML machine learning models. However, importing a dataset with the more than 1,000 columns from a data file, such as a CSV file in Object Storage, involves some preprocessing. ","","In this notebook, we demonstrate the process of importing a wide dataset with 2,002 columns from CSV format into an Oracle Database table with nested columns. ","","The approach is to read the file by chunks, convert each chunk to a transactional format into a database table, and then pivot the data into the nested column format using SQL. Note that the nested column format can be used only through OML4SQL, not OML4Py. ","","To improve the efficiency of the CSV loading, the \"index apply\" functionality of OML4Py is also used to speed up the process and make it parallel.","","Copyright (c) 2025 Oracle Corporation                             ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a>"],"enabled":true,"result":{"startTime":1736204676192,"interpreter":"md.medium","endTime":1736204676685,"results":[{"message":"<h1 id=\"importing-wide-datasets-using-oml4py\">Importing Wide Datasets using OML4Py<\/h1>\n<p>Oracle Database has a limit of 1,000 columns in a table or view. Machine learning projects may involve datasets, perhaps stored as CSV files, with a higher number of columns. OML4SQL in-database algorithms can handle such wide datasets by converting the columns to a special format known as &quot;nested columns&quot;. This allows an efficient handling of high dimensional and sparse features, as well as accomodating more than 1000 predictor columns, when building OML machine learning models. However, importing a dataset with the more than 1,000 columns from a data file, such as a CSV file in Object Storage, involves some preprocessing.<\/p>\n<p>In this notebook, we demonstrate the process of importing a wide dataset with 2,002 columns from CSV format into an Oracle Database table with nested columns.<\/p>\n<p>The approach is to read the file by chunks, convert each chunk to a transactional format into a database table, and then pivot the data into the nested column format using SQL. Note that the nested column format can be used only through OML4SQL, not OML4Py.<\/p>\n<p>To improve the efficiency of the CSV loading, the &quot;index apply&quot; functionality of OML4Py is also used to speed up the process and make it parallel.<\/p>\n<p>Copyright (c) 2025 Oracle Corporation<\/p>\n<h6 id=\"the-universal-permissive-license-upl-version-10\"><a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a><\/h6>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"For more information...","message":["%md","","* <a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB documentation<\/a>","* <a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a>","* <a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML website<\/a>","* <a href=\"https://docs.oracle.com/en/database/oracle/oracle-database/21/adobj/multilevel-collection-types.html\" target=\"_blank\">Oracle nested columns table documentation<\/a>","* <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmapi/use-nested-data.html\" target=\"_blank\">OML using nested data documentation<\/a>","* <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/embedded-python-execution1.html\" target=\"_blank\">OML4Py embedded Python execution documentation<\/a>"],"enabled":true,"result":{"startTime":1736204677158,"interpreter":"md.medium","endTime":1736204677616,"results":[{"message":"<ul>\n<li><a href=\"https://docs.oracle.com/en/cloud/paas/autonomous-data-warehouse-cloud/index.html\" target=\"_blank\">Oracle ADB documentation<\/a><\/li>\n<li><a href=\"https://github.com/oracle-samples/oracle-db-examples/tree/main/machine-learning\" target=\"_blank\">OML folder on Oracle GitHub<\/a><\/li>\n<li><a href=\"https://www.oracle.com/machine-learning\" target=\"_blank\">OML website<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/database/oracle/oracle-database/21/adobj/multilevel-collection-types.html\" target=\"_blank\">Oracle nested columns table documentation<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4sql/23/dmapi/use-nested-data.html\" target=\"_blank\">OML using nested data documentation<\/a><\/li>\n<li><a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/embedded-python-execution1.html\" target=\"_blank\">OML4Py embedded Python execution documentation<\/a><\/li>\n<\/ul>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Import Python libraries","message":["%python","","import pandas as pd","import oml"],"enabled":true,"result":{"startTime":1736204678082,"interpreter":"python.medium","endTime":1736204680680,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create a table to hold the data in transactional format","message":["%script ","","BEGIN","     EXECUTE IMMEDIATE 'DROP TABLE TXN_TBL';","     EXCEPTION WHEN OTHERS THEN NULL;","END;","/","","CREATE TABLE TXN_TBL( ID NUMBER, ","                      NAME VARCHAR2(32),","                      VALUE NUMBER","                    );"],"enabled":true,"result":{"startTime":1736204681139,"interpreter":"script.medium","endTime":1736204683520,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable TXN_TBL created.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create a table that holds the label","message":["%script","","BEGIN","     EXECUTE IMMEDIATE 'DROP TABLE WIDE_LABEL_TBL';","     EXCEPTION WHEN OTHERS THEN NULL;","END;","/","","CREATE TABLE WIDE_LABEL_TBL( ID NUMBER, ","                             CLASS INTEGER","                            );","/"],"enabled":true,"result":{"startTime":1736204683976,"interpreter":"script.medium","endTime":1736204684921,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable WIDE_LABEL_TBL created.\n\n\n---------------------------\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Create supporting user-defined Python functions","* Function to insert multiple records into a database table","* Function to read the data in partitions and pivot the data into transactions","* Function for generating the partitions for the data","","---"],"enabled":true,"result":{"startTime":1736204685582,"interpreter":"md.medium","endTime":1736204686016,"results":[{"message":"<h3 id=\"create-supporting-user-defined-python-functions\">Create supporting user-defined Python functions<\/h3>\n<ul>\n<li>Function to insert multiple records into a database table<\/li>\n<li>Function to read the data in partitions and pivot the data into transactions<\/li>\n<li>Function for generating the partitions for the data<\/li>\n<\/ul>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Functions to insert multiple records into the database table","message":["%python","","import oracledb","","# Insert records using the provided cursor, the statement, and the records","","def insert_records(cr, records, statement):","    try:        ","        cr.executemany(statement, records)","        cr.connection.commit()","    except cx_Oracle.Error as error:","        print('Insert error:')","        print(error)","","# Append the rows in a partition and call the insert_records function","","def insertDF(df, statement):","    cr = oml.cursor()","","    records = []","    for row in df.itertuples(index=False):","        records.append(row)","    insert_records(cr, records, statement)","    cr.close()    "],"enabled":true,"result":{"startTime":1736204686467,"interpreter":"python.medium","endTime":1736204686920,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Function that writes each partition into transactional format","message":["%python","","import gc ","","def import_helper(idx, url, columns, ncol, partitions, chunk_size):","    # Verifies the partition to read","    read_rows = partitions[idx-1][0]","    # Check the largest index of that partition","    total = partitions[idx-1][1] + 1","    ","    while read_rows < total:","        offset = read_rows + 1","        # Reads the data from the defined chunks","        df = pd.read_csv(url, skiprows = offset, nrows = chunk_size, header = None)","        read_rows += df.shape[0]","        df.columns = columns","        # Pivots the data","        txn_df = pd.melt(df, id_vars = ['ID'], value_vars = columns[:ncol])","        txn_df.columns = ['ID', 'NAME', 'VALUE']","        print('Rows '+str(min(txn_df['ID']))+' to '+str(max(txn_df['ID']))+","              ': data pivoted')","        # Write the pivotted data to a database table ","        statement = \"INSERT INTO TXN_TBL (ID, NAME, VALUE) VALUES(:ID, :NAME, :VALUE)\"","        insertDF(txn_df, statement)","        statement = \"INSERT INTO WIDE_LABEL_TBL (ID, CLASS) VALUES(:ID, :CLASS)\"","        label_df = df[['ID','CLASS']]","        insertDF(label_df, statement)","        print('Rows '+str(min(txn_df['ID']))+' to '+str(max(txn_df['ID']))+","              ': inserted into TXN_TBL '+str(txn_df.shape[0])+' rows and '+str(txn_df.shape[1])+' columns')","        # Cleanup temporary elements used","        del df","        del txn_df","        del label_df","        gc.collect()"],"enabled":true,"result":{"startTime":1736204687373,"interpreter":"python.medium","endTime":1736204687822,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Function for generating the partitions for the data","message":["%python","","def generate_part(rows_to_process, num_partitions):","    segment_size = int(rows_to_process/num_partitions)","    result = []","    for i in range(num_partitions):","        result.append([i*segment_size, (i+1)*segment_size-1])","    result[len(result)-1][1] = rows_to_process-1","    return result"],"enabled":true,"result":{"startTime":1736204688271,"interpreter":"python.medium","endTime":1736204688722,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Non-parallel processing","","In the following example, we process the data in chunks sequentially. This takes a significant amount of time. Later, we show doing this in parallel using embedded Python execution. ","","---"],"enabled":true,"result":{"startTime":1736204689172,"interpreter":"md.medium","endTime":1736204689613,"results":[{"message":"<h3 id=\"non-parallel-processing\">Non-parallel processing<\/h3>\n<p>In the following example, we process the data in chunks sequentially. This takes a significant amount of time. Later, we show doing this in parallel using embedded Python execution.<\/p>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Check that the table is empty before inserting","message":["%sql","","SELECT COUNT(1) FROM TXN_TBL "],"enabled":true,"result":{"startTime":1736204690060,"interpreter":"sql.medium","endTime":1736204690707,"results":[{"message":"COUNT(1)\n0\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":5,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create separate partition slices to take advantage of parallelism ","message":["%python","","# Define the total number or rows to process from the dataset","# to a fixed number for this example","rows_to_process = 2000","","# Specify the number of partitions to create","num_partitions = 5","","partitions = generate_part(rows_to_process, num_partitions)","print(\"Generated partitions:\\n\")","print(partitions)"],"enabled":true,"result":{"startTime":1736204691158,"interpreter":"python.medium","endTime":1736204691629,"results":[{"message":"Generated partitions:\n\n[[0, 399], [400, 799], [800, 1199], [1200, 1599], [1600, 1999]]\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":7,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"Sequential run processing the first 2000 rows","message":["%python","","import ssl","ssl._create_default_https_context = ssl._create_unverified_context","","","url = 'https://objectstorage.us-ashburn-1.oraclecloud.com/n/adwc4pm/b/OML_Data/o/wide.csv'","","df = pd.read_csv(url, nrows = 0, skiprows = 0)","columns = list(df.columns)","","# Number of numerical columns in the dataset to be processed","ncol = 2000","# Set the number of records to process at a time (per chunk)","chunk_size = 100","","for i in range(1,6):","    import_helper(i, url, columns, ncol, partitions, chunk_size)"],"enabled":true,"result":{"startTime":1736204692142,"interpreter":"python.medium","endTime":1736204906268,"results":[{"message":"Rows 0 to 99: data pivoted\nRows 0 to 99: inserted into TXN_TBL 200000 rows and 3 columns\nRows 100 to 199: data pivoted\nRows 100 to 199: inserted into TXN_TBL 200000 rows and 3 columns\nRows 200 to 299: data pivoted\nRows 200 to 299: inserted into TXN_TBL 200000 rows and 3 columns\nRows 300 to 399: data pivoted\nRows 300 to 399: inserted into TXN_TBL 200000 rows and 3 columns\nRows 400 to 499: data pivoted\nRows 400 to 499: inserted into TXN_TBL 200000 rows and 3 columns\nRows 500 to 599: data pivoted\nRows 500 to 599: inserted into TXN_TBL 200000 rows and 3 columns\nRows 600 to 699: data pivoted\nRows 600 to 699: inserted into TXN_TBL 200000 rows and 3 columns\nRows 700 to 799: data pivoted\nRows 700 to 799: inserted into TXN_TBL 200000 rows and 3 columns\nRows 800 to 899: data pivoted\nRows 800 to 899: inserted into TXN_TBL 200000 rows and 3 columns\nRows 900 to 999: data pivoted\nRows 900 to 999: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1000 to 1099: data pivoted\nRows 1000 to 1099: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1100 to 1199: data pivoted\nRows 1100 to 1199: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1200 to 1299: data pivoted\nRows 1200 to 1299: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1300 to 1399: data pivoted\nRows 1300 to 1399: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1400 to 1499: data pivoted\nRows 1400 to 1499: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1500 to 1599: data pivoted\nRows 1500 to 1599: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1600 to 1699: data pivoted\nRows 1600 to 1699: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1700 to 1799: data pivoted\nRows 1700 to 1799: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1800 to 1899: data pivoted\nRows 1800 to 1899: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1900 to 1999: data pivoted\nRows 1900 to 1999: inserted into TXN_TBL 200000 rows and 3 columns\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Show a sample of the resulting transactions","message":["%sql","","select * from TXN_TBL FETCH FIRST 10 ROWS ONLY"],"enabled":true,"result":{"startTime":1736204906718,"interpreter":"sql.medium","endTime":1736204907372,"results":[{"message":"ID\tNAME\tVALUE\n1431\tCOL1099\t0.5326441388306492\n1432\tCOL1099\t-0.6320951504897115\n1433\tCOL1099\t-2.3234567893419107\n1434\tCOL1099\t-1.9078389732306136\n1435\tCOL1099\t-1.102783064724585\n1436\tCOL1099\t1.3058725061970131\n1437\tCOL1099\t-0.1992226912738213\n1438\tCOL1099\t-0.8792071994810811\n1439\tCOL1099\t-1.0186926489579629\n1440\tCOL1099\t2.2797658364020417\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Parallel processing using Embedded Python Execution","","The performance improvement is relative to the degree of parallelism enabled. Depending on your Autonomous Database instances CPU allocation, you can explicitly choose the number of Python engines to spawn in parallel. ","","---"],"enabled":true,"result":{"startTime":1736204907829,"interpreter":"md.medium","endTime":1736204908272,"results":[{"message":"<h3 id=\"parallel-processing-using-embedded-python-execution\">Parallel processing using Embedded Python Execution<\/h3>\n<p>The performance improvement is relative to the degree of parallelism enabled. Depending on your Autonomous Database instances CPU allocation, you can explicitly choose the number of Python engines to spawn in parallel.<\/p>\n<hr />\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Remove all data before parallel run","message":["%script","","DELETE FROM WIDE_LABEL_TBL;","DELETE FROM TXN_TBL;"],"enabled":true,"result":{"startTime":1736204908723,"interpreter":"script.medium","endTime":1736204922220,"results":[{"message":"\n2,000 rows deleted.\n\n\n---------------------------\n\n4,000,000 rows deleted.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":4,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"Run in parallel using oml.index_apply","message":["%python","","url = 'https://objectstorage.us-ashburn-1.oraclecloud.com/n/adwc4pm/b/OML_Data/o/wide.csv'","","df = pd.read_csv(url, nrows = 0, skiprows = 0)","columns = list(df.columns)","","ncol = 2000","chunk_size = 100","_ = oml.index_apply(times = 5, func = import_helper, url = url, columns = columns, ","                    ncol = ncol, partitions = partitions, chunk_size = 100, ","                    graphics = False, parallel = True)"],"enabled":true,"result":{"startTime":1736204922689,"interpreter":"python.medium","endTime":1736205022279,"results":[{"message":"Rows 400 to 499: data pivoted\nRows 400 to 499: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1200 to 1299: data pivoted\nRows 800 to 899: data pivoted\nRows 0 to 99: data pivoted\nRows 800 to 899: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1200 to 1299: inserted into TXN_TBL 200000 rows and 3 columns\nRows 0 to 99: inserted into TXN_TBL 200000 rows and 3 columns\nRows 500 to 599: data pivoted\nRows 500 to 599: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1300 to 1399: data pivoted\nRows 900 to 999: data pivoted\nRows 1300 to 1399: inserted into TXN_TBL 200000 rows and 3 columns\nRows 100 to 199: data pivoted\nRows 900 to 999: inserted into TXN_TBL 200000 rows and 3 columns\nRows 100 to 199: inserted into TXN_TBL 200000 rows and 3 columns\nRows 600 to 699: data pivoted\nRows 600 to 699: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1400 to 1499: data pivoted\nRows 1400 to 1499: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1000 to 1099: data pivoted\nRows 1000 to 1099: inserted into TXN_TBL 200000 rows and 3 columns\nRows 200 to 299: data pivoted\nRows 200 to 299: inserted into TXN_TBL 200000 rows and 3 columns\nRows 700 to 799: data pivoted\nRows 1500 to 1599: data pivoted\nRows 700 to 799: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1500 to 1599: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1100 to 1199: data pivoted\nRows 1100 to 1199: inserted into TXN_TBL 200000 rows and 3 columns\nRows 300 to 399: data pivoted\nRows 300 to 399: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1600 to 1699: data pivoted\nRows 1600 to 1699: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1700 to 1799: data pivoted\nRows 1700 to 1799: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1800 to 1899: data pivoted\nRows 1800 to 1899: inserted into TXN_TBL 200000 rows and 3 columns\nRows 1900 to 1999: data pivoted\nRows 1900 to 1999: inserted into TXN_TBL 200000 rows and 3 columns\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":8,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Check the total data loaded","message":["%sql","","select count(1)","from txn_tbl"],"enabled":true,"result":{"startTime":1736205022742,"interpreter":"sql.medium","endTime":1736205023505,"results":[{"message":"COUNT(1)\n4000000\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Check the table with id = 0","message":["%sql","","SELECT *","FROM txn_tbl","WHERE id = 0","FETCH FIRST 10 ROWS ONLY"],"enabled":true,"result":{"startTime":1736205023959,"interpreter":"sql.medium","endTime":1736205024600,"results":[{"message":"ID\tNAME\tVALUE\n0\tCOL1682\t0.6243604363152515\n0\tCOL1683\t-1.4923725443812914\n0\tCOL1684\t0.5193684643702374\n0\tCOL1685\t1.3536412340869812\n0\tCOL1686\t-0.4162404373568376\n0\tCOL1687\t-1.1446508438535214\n0\tCOL1688\t1.0735717054221396\n0\tCOL1689\t0.772978247549586\n0\tCOL1690\t0.0938844634754019\n0\tCOL1691\t-0.7042062638547963\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Check if there are any duplicates","message":["%sql","","SELECT count(distinct name)","FROM TXN_TBL","where id = 0"],"enabled":true,"result":{"startTime":1736205025068,"interpreter":"sql.medium","endTime":1736205025886,"results":[{"message":"COUNT(DISTINCTNAME)\n2000\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"Show the label/class and the id","message":["%sql","","SELECT * FROM WIDE_LABEL_TBL FETCH FIRST 10 ROWS ONLY"],"enabled":true,"result":{"startTime":1736205026339,"interpreter":"sql.medium","endTime":1736205026814,"results":[{"message":"ID\tCLASS\n400\t0\n401\t1\n402\t1\n403\t1\n404\t0\n405\t1\n406\t0\n407\t1\n408\t1\n409\t0\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Create the nested column from the transactional data"],"enabled":true,"result":{"startTime":1736205027269,"interpreter":"md.medium","endTime":1736205027713,"results":[{"message":"<h3 id=\"create-the-nested-column-from-the-transactional-data\">Create the nested column from the transactional data<\/h3>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Create the nested column table and join the labels","message":["%script","","","BEGIN EXECUTE IMMEDIATE 'DROP TABLE TXN_NESTED_COL_NUM';","EXCEPTION WHEN OTHERS THEN NULL; END;","/","","CREATE TABLE  TXN_NESTED_COL_NUM","  NESTED TABLE txn_nested store AS txn_nested_tab AS ","SELECT m.id, m.CLASS, txn_nested","  FROM WIDE_LABEL_TBL m,","  ( SELECT features.id,","           cast(COLLECT(dm_nested_numerical(features.name,features.value)) ","                        as dm_nested_numericals)  txn_nested","    FROM TXN_TBL features","    group by features.id) n","  WHERE m.id = n.id  ","/"],"enabled":true,"result":{"startTime":1736205028172,"interpreter":"script.medium","endTime":1736205054289,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nTable TXN_NESTED_COL_NUM created.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Check that the table contains our nested column","message":["%script","","SELECT * FROM TXN_NESTED_COL_NUM FETCH FIRST 5 ROWS ONLY"],"enabled":true,"result":{"startTime":1736205054750,"interpreter":"script.medium","endTime":1736205056431,"results":[{"message":"ID   CLASS   TXN_NESTED                  \n   1       1 oracle.sql.ARRAY@22a7a3f4   \n   0       1 oracle.sql.ARRAY@63d272e4   \n   2       0 oracle.sql.ARRAY@5b95d195   \n   3       0 oracle.sql.ARRAY@4cfd14c0   \n   9       0 oracle.sql.ARRAY@535aa6a8   \n\n\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Building a Machine Learning model with a Nested Column as input"],"enabled":true,"result":{"startTime":1736205056893,"interpreter":"md.medium","endTime":1736205057332,"results":[{"message":"<h3 id=\"building-a-machine-learning-model-with-a-nested-column-as-input\">Building a Machine Learning model with a Nested Column as input<\/h3>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":"Build a model using the nested column via OML4SQL","message":["%script","","BEGIN DBMS_DATA_MINING.DROP_MODEL('GLM_CLAS_USING_NESTED_COLUMN');","EXCEPTION WHEN OTHERS THEN NULL; END;","/","","DECLARE","    v_setlst DBMS_DATA_MINING.SETTING_LIST;","","BEGIN","   ","    v_setlst(dbms_data_mining.algo_name) := dbms_data_mining.algo_generalized_linear_model;","    v_setlst(dbms_data_mining.prep_auto) :=  dbms_data_mining.prep_auto_on;","   ","   ","    DBMS_DATA_MINING.CREATE_MODEL2(","        model_name          => 'GLM_CLAS_USING_NESTED_COLUMN',","        mining_function     => dbms_data_mining.classification,","        data_query          => 'select * from TXN_NESTED_COL_NUM',","        set_list            => v_setlst,","        case_id_column_name => 'ID',","        target_column_name  => 'CLASS');","END;","/ "],"enabled":true,"result":{"startTime":1736205057792,"interpreter":"script.medium","endTime":1736205090108,"results":[{"message":"\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n\nPL/SQL procedure successfully completed.\n\n\n---------------------------\n","type":"TEXT"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"View the attributes used in building the model","message":["%sql","","SELECT attribute_name, attribute_type","  FROM user_mining_model_attributes"," WHERE model_name = 'GLM_CLAS_USING_NESTED_COLUMN'","ORDER BY attribute_name;"],"enabled":true,"result":{"startTime":1736205090572,"interpreter":"sql.medium","endTime":1736205091050,"results":[{"message":"ATTRIBUTE_NAME\tATTRIBUTE_TYPE\nCLASS\tCATEGORICAL\nTXN_NESTED\tNUMERICAL\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":"List of available model views with various model details","message":["%sql","","SELECT *","  FROM user_mining_model_views"," WHERE model_name = 'GLM_CLAS_USING_NESTED_COLUMN'"],"enabled":true,"result":{"startTime":1736205091511,"interpreter":"sql.medium","endTime":1736205092013,"results":[{"message":"MODEL_NAME\tVIEW_NAME\tVIEW_TYPE\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VAGLM_CLAS_USING_NESTED_COLUMN\tGLM Classification Row Diagnostics\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VDGLM_CLAS_USING_NESTED_COLUMN\tGLM Classification Attribute Diagnostics\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VCGLM_CLAS_USING_NESTED_COLUMN\tScoring Cost Matrix\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VTGLM_CLAS_USING_NESTED_COLUMN\tClassification Targets\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VGGLM_CLAS_USING_NESTED_COLUMN\tGlobal Name-Value Pairs\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VSGLM_CLAS_USING_NESTED_COLUMN\tComputed Settings\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VWGLM_CLAS_USING_NESTED_COLUMN\tModel Build Alerts\nGLM_CLAS_USING_NESTED_COLUMN\tDM$VNGLM_CLAS_USING_NESTED_COLUMN\tNormalization and Missing Value Handling\n","type":"TABLE"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## End of Script"],"enabled":true,"result":{"startTime":1736205092470,"interpreter":"md.medium","endTime":1736205092914,"results":[{"message":"<h2 id=\"end-of-script\">End of Script<\/h2>\n","type":"HTML"}],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md"],"enabled":true,"result":{"startTime":1736205093370,"interpreter":"md.medium","endTime":1736205093820,"results":[],"taskStatus":"SUCCESS","forms":"[]","status":"SUCCESS"},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"6","snapshot":false,"tags":null}]