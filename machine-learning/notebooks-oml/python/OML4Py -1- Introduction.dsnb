[{"layout":"zeppelin","isRunnable":true,"template":null,"templateConfig":null,"isEditable":true,"name":"OML4Py -1- Introduction","description":null,"type":"low","paragraphs":[{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":null,"title":null,"message":[],"enabled":true,"result":{"startTime":1737139191056,"interpreter":"md.low","endTime":1737139191528,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":0,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# Oracle Machine Learning for Python (OML4Py)  ","","***Oracle Machine Learning for Python*** (OML4Py) makes the open source Python scripting language and environment ready for the enterprise and big data. Designed for problems involving both large and small data volumes, OML4Py integrates Python with Oracle Autonomous Database, allowing users to run Python commands and scripts for statistical, machine learning, and visualization analyses on database tables and views using Python syntax. Many familiar Python functions are overloaded that translate Python behavior into SQL for running in-database, as well as new automatic machine learning capabilities.","","In this notebook, we highlight a few of the OML4Py features:","","* Load OML library","* Create database tables","* Use the transparency layer","* Rank attributes for predictive value using the in-database attribute importance algorithm","* Build predictive models","* Score data using these models","","Copyright (c) 2026 Oracle Corporation ","###### <a href=\"https://oss.oracle.com/licenses/upl/\" target=\"_blank\">The Universal Permissive License (UPL), Version 1.0<\/a>","---"],"enabled":true,"result":{"startTime":1737139191998,"interpreter":"md.low","endTime":1737139192463,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# Import libraries supporting OML4Py","","To use OML4Py, first import the package ***oml***. ","","Note: The Oracle Database connectivity package ***cx_Oracle*** is used to support database access and users can get access to the underlying connection to use ***cx_Oracle*** directly via the function ***oml.cursor***. See","<a href=\"https://cx-oracle.readthedocs.io/en/latest\" target=\"_blank\"> this link to cx_Oracle docs<\/a> for general ***cx_Oracle*** documentation. ","","Users can get online help using Python's help function and specifying the function of interest."],"enabled":true,"result":{"startTime":1737139192957,"interpreter":"md.low","endTime":1737139193406,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":"Import libraries and set display options","message":["%python ","","import pandas as pd","import oml","import warnings","","pd.set_option('display.max_rows', 500)","pd.set_option('display.max_columns', 500)","pd.set_option('display.width', 1000)","warnings.simplefilter(action='ignore', category=FutureWarning)"],"enabled":true,"result":{"startTime":1737139193893,"interpreter":"python.low","endTime":1737139194377,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":"Look up help on OML4Py and other functions","message":["%python","","help(oml.push)"],"enabled":true,"result":{"startTime":1737139194849,"interpreter":"python.low","endTime":1737139195328,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":true,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# OML4Py Transparency Layer functionality","","## Create a Pandas DataFrame and load into the database","","We have a couple of options for loading data into the database from Python. In this first example, we load the **iris** data and combine target and predictors into a single DataFrame, which matches the form the data would have as a database table. This Pandas DataFrame can then be loaded into the database using the ***push*** function, which creates a temporary table and returns a proxy object that we assign to variable IRIS_TMP. Such temporary tables will be automatically deleted when the database connection is terminated unless saved in a datastore (the topic of 'datastore' is covered in another notebook).","","We then invoke standard functions like ***shape*** and ***columns***, as well as ***head***, to begin to explore the data."],"enabled":true,"result":{"startTime":1737139195810,"interpreter":"md.low","endTime":1737139196266,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","from sklearn.datasets import load_iris","from sklearn import linear_model","import pandas as pd","","iris = load_iris()","x = pd.DataFrame(iris.data, ","                 columns = [\"SEPAL_LENGTH\", \"SEPAL_WIDTH\", \"PETAL_LENGTH\", \"PETAL_WIDTH\"])","y = pd.DataFrame(list(map(lambda x: {0:'setosa', 1: 'versicolor', 2:'virginica'}[x], iris.target)), ","                 columns = ['SPECIES'])","iris_df = pd.concat([x,y], axis=1)","","IRIS_TMP = oml.push(iris_df)","print(\"Shape:\",IRIS_TMP.shape)","print(\"Columns:\",IRIS_TMP.columns)","z.show(IRIS_TMP.head(4))"],"enabled":true,"result":{"startTime":1737139196754,"interpreter":"python.low","endTime":1737139197535,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Create a persistent table","We can also create a persistent table using the ***create*** function and specifying a tablename, *IRIS*. This table is now accessible both within OML4Py but also directly from SQL.","","Use the function ***z.show*** to automatically pull the desired data to the Python for display in the notebook. By doing this, you can also use the built-in Zeppelin visualization options such as bar, pie, area, line, and scatter plots. "],"enabled":true,"result":{"startTime":1737139198005,"interpreter":"md.low","endTime":1737139198471,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","try:","    oml.drop(table=\"IRIS\")","except:","    pass","IRIS = oml.create(iris_df, table=\"IRIS\")","print(\"Shape:\",IRIS.shape)","z.show(IRIS.head(10))"],"enabled":true,"result":{"startTime":1737139198958,"interpreter":"python.low","endTime":1737139199575,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Transparency layer functions available on an OML DataFrame","","List the functions defined for an OML DataFrame proxy object, in this case \"IRIS\"."],"enabled":true,"result":{"startTime":1737139200043,"interpreter":"md.low","endTime":1737139200491,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","res = [x for x in IRIS.__dir__() if not x.startswith('_')]","res.sort()","res"],"enabled":true,"result":{"startTime":1737139200951,"interpreter":"python.low","endTime":1737139201414,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","## Using standard Python syntax on database data","","Perform a few operations on the SEPAL_LENGTH column of the IRIS database table using the transparency layer. Note that standard Python syntax is used. "],"enabled":true,"result":{"startTime":1737139201887,"interpreter":"md.low","endTime":1737139202335,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["                    %python","","print(\"Add 5 to each SEPAL_LENGTH: \",IRIS[\"SEPAL_LENGTH\"] + 5)","print(\"\\nMin SEPAL_LENGTH: \", IRIS[\"SEPAL_LENGTH\"].min())","print(\"\\nMean SEPAL_LENGTH: \",IRIS[\"SEPAL_LENGTH\"].mean())"],"enabled":true,"result":{"startTime":1737139202804,"interpreter":"python.low","endTime":1737139203416,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Data masking","Explore masking using IRIS PETAL_LENGTH column. Note that standard Python syntax is used. "],"enabled":true,"result":{"startTime":1737139203889,"interpreter":"md.low","endTime":1737139204335,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","print(\"PETAL_LENGTH: \", IRIS[\"PETAL_LENGTH\"])","","MASK1 = IRIS[\"PETAL_LENGTH\"] > 5.1","print(\"\\nPETAL_LENGTH > 5.1: \", IRIS[\"PETAL_LENGTH\"][MASK1])","","MASK2 = (IRIS[\"PETAL_LENGTH\"] < 1.4) | (IRIS[\"PETAL_LENGTH\"] > 5.6)","print(\"\\nPETAL_LENGTH < 1.4 | > 5.6: \", IRIS[\"PETAL_LENGTH\"][MASK2])"],"enabled":true,"result":{"startTime":1737139204815,"interpreter":"python.low","endTime":1737139205422,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Explore data by computing pairwise correlation","Using only numeric columns, we can compute a correlation matrix on the proxy object for the database table *IRIS* using the overloaded ***corr*** function. Here we see that petal length and petal width are highly correlated."],"enabled":true,"result":{"startTime":1737139205915,"interpreter":"md.low","endTime":1737139206374,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","IRIS.corr()"],"enabled":true,"result":{"startTime":1737139206844,"interpreter":"python.low","endTime":1737139207418,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Explore distribution of IRIS numeric columns","","OML4Py overloads select graphics functions as well. Here, we illustrate the use of ***boxplot*** to show the distribution of the length and width columns. Here, the statistical computations take place in the database - avoiding data movement - and returns only the summary statistics needed to produce the plot, which enables scalability. No overhead is incurred for moving the data to the client for processing, whether 150 rows (as in *IRIS*) or 150 million rows."],"enabled":true,"result":{"startTime":1737139207900,"interpreter":"md.low","endTime":1737139208373,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","import matplotlib.pyplot as plt","","oml.graphics.boxplot(IRIS[:, :4], notch=True, showmeans = True, ","                     labels=['Sepal Length', 'Sepal Width','Petal Length', 'Petal Width'])","plt.title('Distribution of IRIS Attributes')","plt.ylabel('cm');"],"enabled":true,"result":{"startTime":1737139208842,"interpreter":"python.low","endTime":1737139210307,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# Use in-database ML algorithms ","","## Compute attribute importance ranking of variables","","Using the *IRIS* table, determine which variables (a.k.a., attributes or predictors) are most important in predicting target 'SPECIES'.","","Since we're starting with a database table, we split *IRIS* into test and train data sets, and then separate the target from the predictors in the training set.","","In the ***setting*** variable, we disable sampling. Note that OML4Py provides parameters to algorithms as name-value pairs. See the OML4Py Users Guide for available options.","","Then, we define the attribute importance object, compute attribute importance using function fit, and show the results, which includes the importance ranking.","","Notice that petal width is most predictive of the target 'SPECIES'. The importance value produced by this algorithm provides a relative ranking, not an absolute number, to be used to distinguish importance among variables."],"enabled":true,"result":{"startTime":1737139210797,"interpreter":"md.low","endTime":1737139211253,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%python","","from oml import ai","","IRIS_train_dat, IRIS_test_dat = IRIS.split() ","IRIS_train_x = IRIS_train_dat.drop('SPECIES')","IRIS_train_y = IRIS_train_dat['SPECIES']"],"enabled":true,"result":{"startTime":1737139211735,"interpreter":"python.low","endTime":1737139212521,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","setting = {'ODMS_SAMPLING':'ODMS_SAMPLING_DISABLE'}","","ai_obj = ai(**setting)","ai_obj = ai_obj.fit(IRIS_train_x, IRIS_train_y)","","ai_obj"],"enabled":true,"result":{"startTime":1737139212994,"interpreter":"python.low","endTime":1737139214687,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"table","title":null,"message":["%python","","z.show(ai_obj.importance)"],"enabled":true,"result":{"startTime":1737139215166,"interpreter":"python.low","endTime":1737139215669,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":6,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Build predictive models","","In this example, we set up the data and a ***demo*** cost matrix to build a Random Forest model to predict 'SPECIES' from the *IRIS* table.","","Note that we create the cost matrix as a named database table, *RF_COST*."],"enabled":true,"result":{"startTime":1737139216159,"interpreter":"md.low","endTime":1737139216635,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","cost_matrix = [['setosa', 'setosa', 0],","  ['setosa', 'virginica', 0.2],","  ['setosa', 'versicolor', 0.8],","  ['virginica', 'virginica', 0],","  ['virginica', 'setosa', 0.5],","  ['virginica', 'versicolor', 0.5],","  ['versicolor', 'versicolor', 0],","  ['versicolor', 'setosa', 0.4],","  ['versicolor', 'virginica', 0.6]]","  ","try:","    oml.drop(table='RF_COST')","except:","    pass","","cost_matrix = oml.create(pd.DataFrame(cost_matrix, columns = ['ACTUAL_TARGET_VALUE', 'PREDICTED_TARGET_VALUE', 'COST']), \"RF_COST\")","cost_matrix.pull().pivot(index='ACTUAL_TARGET_VALUE', ","                         columns='PREDICTED_TARGET_VALUE',values='COST')"],"enabled":true,"result":{"startTime":1737139217102,"interpreter":"python.low","endTime":1737139217689,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","### Build a Random Forest model using the Cost Matrix","Build a Random Forest model specifying a maximum tree depth of 4, and display model details.","Note that the model also reports attribute importance."],"enabled":true,"result":{"startTime":1737139218188,"interpreter":"md.low","endTime":1737139218637,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","from oml import rf","","rf_mod = rf(tree_term_max_depth = '4')","rf_mod = rf_mod.fit(IRIS_train_x, IRIS_train_y, cost_matrix = cost_matrix)","","rf_mod"],"enabled":true,"result":{"startTime":1737139219121,"interpreter":"python.low","endTime":1737139220428,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Use the Random Forest model to predict SPECIES","","When predicting values, users can include supplemental columns from the original data. This can be particularly useful to compare actual target values against predicted values, or to include unique keys for subsequent row identification. This is necessary since row order is not implicitly maintained on results from the database. This is consistent with how SQL and relational databases provide ordering only if requested by the user via a sort."],"enabled":true,"result":{"startTime":1737139220889,"interpreter":"md.low","endTime":1737139221340,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","pred = rf_mod.predict(IRIS_test_dat.drop('SPECIES'), ","                      supplemental_cols = IRIS_test_dat[:, ['SEPAL_LENGTH', 'SEPAL_WIDTH', 'PETAL_LENGTH', 'SPECIES']])","print(\"Shape:\",pred.shape)","z.show(pred.head(10))"],"enabled":true,"result":{"startTime":1737139221813,"interpreter":"python.low","endTime":1737139222462,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Generate and display a Confusion Matrix for the predicted results","","Using the overloaded ***crosstab*** function, compute the confusion matrix between the actual values in SPECIES and the predictions in the PREDICTION column."],"enabled":true,"result":{"startTime":1737139222939,"interpreter":"md.low","endTime":1737139223405,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","res_ct = pred.crosstab('SPECIES','PREDICTION',pivot=True)","print(\"Type:\",type(res_ct))","print(\"Columns:\",res_ct.columns)"],"enabled":true,"result":{"startTime":1737139223873,"interpreter":"python.low","endTime":1737139224783,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Sort the rows","Since columns are sorted by name after pivoting, but the rows are not, sort the rows as a post-processing step."],"enabled":true,"result":{"startTime":1737139225246,"interpreter":"md.low","endTime":1737139225707,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","res_ct.sort_values(by='SPECIES')"],"enabled":true,"result":{"startTime":1737139226178,"interpreter":"python.low","endTime":1737139226656,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","## Build an Anomaly Detection Model with SVM","","The Support Vector Machine algorithms supports a one-class SVM option for anomaly detection. Predictions with value 0 are considered anomalies. Users can specify various settings, e.g., the outlier rate or the type of SVM kernel functions."],"enabled":true,"result":{"startTime":1737139227128,"interpreter":"md.low","endTime":1737139227581,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":"[{\"raw\":{\"height\":300,\"lastColumns\":[],\"version\":1}}]","hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","from oml import svm","","settings = {'svms_outlier_rate' : 0.05}","svm_mod = svm('anomaly_detection', svms_kernel_function = 'dbms_data_mining.svms_linear',**settings)","svm_mod = svm_mod.fit(IRIS, None)","","svm_mod"],"enabled":true,"result":{"startTime":1737139228066,"interpreter":"python.low","endTime":1737139229780,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Predict which cases are anomalies","We can predict which cases are anomalies using the ***predict*** function. If ***proba*** is set to True, we will get the probability associated with the prediction."],"enabled":true,"result":{"startTime":1737139230242,"interpreter":"md.low","endTime":1737139230693,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","res = svm_mod.predict(IRIS, proba = True)","print(\"Type:\", type(res))","z.show(res.head(4))"],"enabled":true,"result":{"startTime":1737139231154,"interpreter":"python.low","endTime":1737139231696,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","### Assess how many anomalies were identified","Let's assess how many anomalies were identified. Here we see that roughly 5% are reported as indicated from our setting above."],"enabled":true,"result":{"startTime":1737139232157,"interpreter":"md.low","endTime":1737139232599,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","","anomalies = res[res['PREDICTION'] == 0]","","print(\"Type:\", type(anomalies))","print(\"IRIS Shape:\", IRIS.shape)","print(\"Anomalies Shape:\", anomalies.shape)","z.show(anomalies.head(10))"],"enabled":true,"result":{"startTime":1737139233060,"interpreter":"python.low","endTime":1737139234029,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","## Obtain attribute importance for supervised models using machine learning explainability (MLX)","","Machine Learning Explainability (MLX) aids in explaining machine learning model behavior, by providing model-agnostic explanations for classification and regression algorithms. This treats the model as a black box instead of using properties from the model itself to guide the explanation. The technique used is called _Global Permutation Importance_ (GPI).","","Read more about it in <a href=\"https://docs.oracle.com/en/database/oracle/machine-learning/oml4py/2/mlpug/model-explainability.html\" target=\"_blank\">the documentation for Model Explainability (MLX) <\/a> "],"enabled":true,"result":{"startTime":1737139234489,"interpreter":"md.low","endTime":1737139234928,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"raw","title":null,"message":["%python","import oml","from oml.mlx import GlobalFeatureImportance","","IRIS_model = oml.dt().fit(IRIS_train_x, IRIS_train_y)","IRIS_exp = GlobalFeatureImportance(mining_function='classification',score_metric='f1_weighted',random_state=42, parallel=4)","IRIS_res = IRIS_exp.explain(IRIS_model, IRIS_train_x, IRIS_train_y, n_iter=8)","IRIS_res"],"enabled":true,"result":{"startTime":1737139235404,"interpreter":"python.low","endTime":1737139240087,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":false,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":false,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md","","# End of Script"],"enabled":true,"result":{"startTime":1737139240548,"interpreter":"md.low","endTime":1737139240987,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":false,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"},{"col":0,"visualizationConfig":null,"hideInIFrame":false,"selectedVisualization":"html","title":null,"message":["%md"],"enabled":true,"result":{"startTime":1737139241448,"interpreter":"md.low","endTime":1737139241893,"results":null,"taskStatus":null,"forms":null,"status":null},"sizeX":0,"hideCode":true,"width":12,"hideResult":true,"dynamicFormParams":"{}","row":0,"hasTitle":false,"hideVizConfig":true,"hideGutter":true,"relations":[],"forms":"[]"}],"version":"7","snapshot":false,"tags":null}]